
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7.2. Requêtes depuis R : mongolite &#8212; MongoDB : notes de cours</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Annexe A : Exemple de fichier source" href="app_exemple.html" />
    <link rel="prev" title="7.1. Requêtes depuis Python : pymongo" href="07_scripts_py.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">MongoDB : notes de cours</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="00_intro.html">
   MongoDB : Notes de cours
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Chapitres
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_find.html">
   1. Premières requêtes en MongoDB
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_listes.html">
   2. Attributs de type liste
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_dates.html">
   3. Attributs de type date
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_index.html">
   4. Les index
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_agreg.html">
   5. Les requêtes d’agrégation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_modif.html">
   6. Les requêtes de modification
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="07_scripts.html">
   7. Effectuer des requêtes depuis des programmes Python ou R
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="07_scripts_py.html">
     7.1. Requêtes depuis Python :
     <code class="docutils literal notranslate">
      <span class="pre">
       pymongo
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     7.2. Requêtes depuis R :
     <code class="docutils literal notranslate">
      <span class="pre">
       mongolite
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Annexes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="app_exemple.html">
   Annexe A : Exemple de fichier source
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="app_git.html">
   Annexe B : Utilisation de
   <code class="docutils literal notranslate">
    <span class="pre">
     git
    </span>
   </code>
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/content/07_scripts_R.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/content/07_scripts_R.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/rtavenar/mongo_book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/rtavenar/mongo_book/issues/new?title=Issue%20on%20page%20%2Fcontent/07_scripts_R.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/rtavenar/mongo_book/main?urlpath=tree/docs/content/07_scripts_R.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation-du-package-mongolite-et-connexion-a-un-serveur-mongodb">
   7.2.1. Installation du package mongolite et connexion à un serveur MongoDB
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installation-et-chargement-du-package-mongolite">
     7.2.1.1. Installation et chargement du package mongolite
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#connexion-a-une-collection-d-une-base-de-donnees-presente-sur-un-serveur-mongodb">
     7.2.1.2. Connexion à une collection d’une base de données présente sur un serveur MongoDB
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#requetes-de-donnees">
   7.2.2. Requêtes de données
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methode-count">
     7.2.2.1. Méthode count
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methode-find">
     7.2.2.2. Méthode find
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methode-iterate">
     7.2.2.3. Méthode iterate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methode-distinct">
     7.2.2.4. Méthode distinct
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selectionner-par-date">
     7.2.2.5. Sélectionner par date
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregations">
   7.2.3. Aggrégations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#manipulation-de-donnees">
   7.2.4. Manipulation de données
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methode-insert">
     7.2.4.1. Méthode insert
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methode-remove">
     7.2.4.2. Méthode remove
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methodes-update-upsert">
     7.2.4.3. Méthodes update/upsert
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-et-export-de-donnees">
   7.2.5. Import et export de données
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#la-methode-export-import-pour-json">
     7.2.5.1. La méthode export/import pour JSON
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#autres-formats-d-export-jsonlite-bjson">
     7.2.5.2. Autres formats d’export (jsonlite/bjson/…)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercices">
   7.2.6. Exercices
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#consignes">
     7.2.6.1. Consignes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correction">
     7.2.6.2. Correction
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="requetes-depuis-r-mongolite">
<span id="sec-mongolite"></span><h1><span class="section-number">7.2. </span>Requêtes depuis R : <code class="docutils literal notranslate"><span class="pre">mongolite</span></code><a class="headerlink" href="#requetes-depuis-r-mongolite" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Auteurs/trices : <strong>Faisal JAYOUZI, Paul LANCELIN, Yolan PERONNET</strong></p></li>
</ul>
<p>Le chapitre suivant a pour objectif d’explorer le package mongolite permettant d’effectuer des requêtes MongoDB depuis R. La rédaction du tutoriel suivant trouve sa source dans la documentation rédigée par l’auteur du package mongolite, Jeroen Ooms. Celle-ci est accessible à l’adresse suivante : <a class="reference external" href="https://jeroen.github.io/mongolite/">https://jeroen.github.io/mongolite/</a></p>
<div class="section" id="installation-du-package-mongolite-et-connexion-a-un-serveur-mongodb">
<h2><span class="section-number">7.2.1. </span>Installation du package mongolite et connexion à un serveur MongoDB<a class="headerlink" href="#installation-du-package-mongolite-et-connexion-a-un-serveur-mongodb" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installation-et-chargement-du-package-mongolite">
<h3><span class="section-number">7.2.1.1. </span>Installation et chargement du package mongolite<a class="headerlink" href="#installation-et-chargement-du-package-mongolite" title="Permalink to this headline">¶</a></h3>
<p>Les packages binaires de mongolite peuvent être installés directement depuis le CRAN via la manipulation suivante à partir de la barre d’outils de RStudio :</p>
<hr class="docutils" />
<p><strong>Tools -&gt; Install Packages -&gt; mongolite -&gt; Install</strong></p>
<hr class="docutils" />
<p>Ou via la commande suivante à exécuter dans la console ou depuis un script R :</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;mongolite&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Vous pouvez également installer la version de développement, qui contient les dernières fonctionnalités. Pour cela, exécutez la commande suivante :</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">devtools</span><span class="o">::</span><span class="nf">install_github</span><span class="p">(</span><span class="s">&quot;jeroen/mongolite&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-remarque admonition">
<p class="admonition-title">Remarque</p>
<p>L’installation et le chargement du package devtools au préalable sera nécessaire pour cette dernière exécution.</p>
</div>
<p>Une fois le package installé, il vous suffira de le charger dans votre envionnement de travail R via la commande suivante à exécuter dans la console ou depuis un script R :</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">mongolite</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="connexion-a-une-collection-d-une-base-de-donnees-presente-sur-un-serveur-mongodb">
<h3><span class="section-number">7.2.1.2. </span>Connexion à une collection d’une base de données présente sur un serveur MongoDB<a class="headerlink" href="#connexion-a-une-collection-d-une-base-de-donnees-presente-sur-un-serveur-mongodb" title="Permalink to this headline">¶</a></h3>
<p>Après avoir chargé les packages nécessaires dans votre environnement R, vous pourrez vous connecter à une collection d’une base de données présente sur un serveur MongoDB à partir d’un lien URI, du nom de la base de données, et du nom de la collection à laquelle vous souhaitez accéder. Pour ce faire, il suffit d’utiliser la fonction <code class="docutils literal notranslate"><span class="pre">mongo()</span></code> de la librairie <em>mongolite</em> de la manière suivante :</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">coll</span> <span class="o">&lt;-</span> <span class="nf">mongo</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s">&quot;ma_collection&quot;</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s">&quot;ma_BDD&quot;</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="s">&quot;mon_uri&quot;</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">mongo()</span></code> prend en entrée les arguments suivants :</p>
<ul class="simple">
<li><p>collection : nom de la collection à laquelle se connecter. La valeur par défaut est “test”</p></li>
<li><p>db : nom de la base de données à laquelle se connecter. La valeur par défaut est “test”.</p></li>
<li><p>url : adresse du serveur MongoDB au format URI standard.</p></li>
<li><p>verbose : si TRUE, émet une sortie supplémentaire</p></li>
<li><p>options : options de connexion supplémentaires telles que les clés et certificats SSL que nous ne developperons pas dans ce tutoriel.</p></li>
</ul>
<div class="admonition-remarque admonition">
<p class="admonition-title">Remarque</p>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">mongo()</span></code> prend obligatoirement en entrée le nom d’une collection d’une base de données. Nous comprenons alors que mongolite nous permet seulement d’intéragir avec une collection d’une base données, et non pas avec la base tout entière. Ici nous aurons donc qu’un seul objet pointant sur une collection avec laquelle intéragir. Nous n’aurons donc pas comme sur python et sa librarie pymongo d’objets clients et d’objets base de données.</p>
</div>
<div class="tip admonition">
<p class="admonition-title">Astuce</p>
<p>L’adresse URI à spécifier dans le paramètre URL définit l’adresse du serveur et des options de connexion supplémentaires. Parmi ces options, nous pouvons notamment spécifier des mots de passe que nous vous conseillons de lire dans des fichiers externes afin d’en préserver la confidentialité. Afin d’obtenir plus de précisions sur le format exact de l’URI attendu (authentification, tunnel SSH, options SSL et options de réplique), nous vous renvoyons à la <a class="reference external" href="https://jeroen.github.io/mongolite/connecting-to-mongodb.html">documentation</a>.</p>
</div>
<p>Pour ce qui est de sa sortie, la fonction <code class="docutils literal notranslate"><span class="pre">mongo()</span></code> renvoie un objet propre à sa librairie mère, une <em>Mongo collection</em>, qui, comme nous l’avons vu précédemment, pointe sur une collection d’une base de données. Regardons de plus près à quoi correspond ce type d’objet sur un exemple concret. Ici nous nous connectons à la collection “NYfood” d’une base de données “food” contenant de nombreuses informations sur les restaurants de New-York.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">mongolite</span><span class="p">)</span>
<span class="n">coll</span> <span class="o">&lt;-</span> <span class="nf">mongo</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s">&quot;NYfood&quot;</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s">&quot;food&quot;</span><span class="p">,</span><span class="n">url</span> <span class="o">=</span> <span class="s">&quot;mongodb://localhost:27017/food&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">coll</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Mongo collection&gt; &#39;NYfood&#39; 
 $aggregate(pipeline = &quot;{}&quot;, options = &quot;{\&quot;allowDiskUse\&quot;:true}&quot;, handler = NULL, pagesize = 1000, iterate = FALSE) 
 $count(query = &quot;{}&quot;) 
 $disconnect(gc = TRUE) 
 $distinct(key, query = &quot;{}&quot;) 
 $drop() 
 $export(con = stdout(), bson = FALSE, query = &quot;{}&quot;, fields = &quot;{}&quot;, sort = &quot;{\&quot;_id\&quot;:1}&quot;) 
 $find(query = &quot;{}&quot;, fields = &quot;{\&quot;_id\&quot;:0}&quot;, sort = &quot;{}&quot;, skip = 0, limit = 0, handler = NULL, pagesize = 1000) 
 $import(con, bson = FALSE) 
 $index(add = NULL, remove = NULL) 
 $info() 
 $insert(data, pagesize = 1000, stop_on_error = TRUE, ...) 
 $iterate(query = &quot;{}&quot;, fields = &quot;{\&quot;_id\&quot;:0}&quot;, sort = &quot;{}&quot;, skip = 0, limit = 0) 
 $mapreduce(map, reduce, query = &quot;{}&quot;, sort = &quot;{}&quot;, limit = 0, out = NULL, scope = NULL) 
 $remove(query, just_one = FALSE) 
 $rename(name, db = NULL) 
 $replace(query, update = &quot;{}&quot;, upsert = FALSE) 
 $run(command = &quot;{\&quot;ping\&quot;: 1}&quot;, simplify = TRUE) 
 $update(query, update = &quot;{\&quot;$set\&quot;:{}}&quot;, filters = NULL, upsert = FALSE, multiple = FALSE) 
</pre></div>
</div>
</div>
</div>
<p>Nous constatons alors que la <em>Mongo collection</em> est un environnement contenant les informations de la collection “NYfood” avec lequel nous pouvons intéragir via de nombreuses méthodes. Chacune de ces méthodes s’appliquera sur une <em>Mongo collection</em> à l’aide d’un <code class="docutils literal notranslate"><span class="pre">$</span></code> et permettra d’effectuer l’équivalent d’une requête MondoDB sur une collection. Par exemple, pour faire une simple requête find en <em>NoSQL</em> récupérant tous les documents d’une collection, il suffira d’écrire :</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">coll</span><span class="o">$</span><span class="nf">find</span><span class="p">()</span>
</pre></div>
</div>
<p>Ou encore pour affichez la liste des index de la collection NYfood, il suffira d’écrire :</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">coll</span><span class="o">$</span><span class="nf">index</span><span class="p">()</span>
</pre></div>
</div>
<p>L’objet des prochaines sections de ce chapitre sera alors d’explorer ces différentes méthodes et de voir leurs requêtes équivalentes en NoSQL. Nous reviendrons notamment sur les objets renvoyés par ces différentes méthodes. Toutefois, nous pouvons d’ores et déjà remarquer qu’une méthode <code class="docutils literal notranslate"><span class="pre">find()</span></code> renvoie la collection complète dans un <em>dataframe</em> ce qui, dans des cas de grands volumes de données, pourrait entrainer des saturations de mémoire de votre machine. Nous verrons par la suite que pour s’affranchir de ce problème, nous pourrons utiliser une méthode <code class="docutils literal notranslate"><span class="pre">iterate()</span></code>, similaire à la méthode <code class="docutils literal notranslate"><span class="pre">find()</span></code>, renvoyant non plus un <em>dataframe</em>, mais un <em>Mongo iterator</em>. Un <em>Mongo iterator</em> est un objet propre à <em>mongolite</em> permettant de ne pas stocker explicitement en mémoire le résultat d’une requête mais d’en conserver un itérateur.</p>
</div>
</div>
<div class="section" id="requetes-de-donnees">
<h2><span class="section-number">7.2.2. </span>Requêtes de données<a class="headerlink" href="#requetes-de-donnees" title="Permalink to this headline">¶</a></h2>
<p><em>Mongolite</em> utilise une syntaxe JSON dans les arguments de ses méthodes pour interroger des collections. Cette syntaxe JSON devra être spécifiée sous forme de chaîne de caractère dans R. Ces différentes chaînes feront alors l’objet de divers paramètres pour les méthodes présentées dans ce chapitre.</p>
<div class="section" id="methode-count">
<h3><span class="section-number">7.2.2.1. </span>Méthode count<a class="headerlink" href="#methode-count" title="Permalink to this headline">¶</a></h3>
<p>Tout comme le <code class="docutils literal notranslate"><span class="pre">.count()</span></code> en MongoDB (<a class="reference external" href="https://rtavenar.github.io/mongo_book/content/01_find.html">plus de précisions ici</a>), la méthode <code class="docutils literal notranslate"><span class="pre">count()</span></code> nous permet de calculer le nombre de résultats d’une collection, ou encore le nombre de résultats d’une certaine requête. Cette méthode n’a qu’un seul argument (query) et sa valeur par défaut est “{}”. Elle renvoie un entier.</p>
<p><strong>Exemples :</strong></p>
<p>Afficher le nombre de résultats de la base NYfood par exemple :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">req</span> <span class="o">=</span> <span class="s">&quot;{}&quot;</span>
<span class="n">coll</span><span class="o">$</span><span class="nf">count</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">req</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">25357</div></div>
</div>
<p>Nous pouvons également noter l’équivalent en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="6ccf0363-5ef4-454b-b7a2-98d978357223" name="05945eb7-7f89-4154-997a-bc205545f6e9" type="radio">
</input><label class="tabbed-label" for="6ccf0363-5ef4-454b-b7a2-98d978357223">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">req</span> <span class="o">=</span> <span class="s">&quot;{}&quot;</span>
<span class="n">coll</span><span class="o">$</span><span class="nf">count</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">req</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="d5704df5-4bc8-420b-929a-08533de908d9" name="05945eb7-7f89-4154-997a-bc205545f6e9" type="radio">
</input><label class="tabbed-label" for="d5704df5-4bc8-420b-929a-08533de908d9">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">NYfood</span><span class="p">.</span><span class="nx">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Et pour afficher le nombre de restaurants chinois :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="2d4b7c81-ae44-4568-b91b-229ec42df2cb" name="a942cfc2-0651-4ba1-b4cd-03dac8260244" type="radio">
</input><label class="tabbed-label" for="2d4b7c81-ae44-4568-b91b-229ec42df2cb">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">req</span> <span class="o">=</span> <span class="s">&#39;{&quot;cuisine&quot;:&quot;Chinese&quot;}&#39;</span>
<span class="n">coll</span><span class="o">$</span><span class="nf">count</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">req</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="dcb16678-acbb-4a35-ab55-16090e7898eb" name="a942cfc2-0651-4ba1-b4cd-03dac8260244" type="radio">
</input><label class="tabbed-label" for="dcb16678-acbb-4a35-ab55-16090e7898eb">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">NYfood</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;cuisine&quot;</span><span class="o">:</span><span class="s2">&quot;Chinese&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="methode-find">
<h3><span class="section-number">7.2.2.2. </span>Méthode find<a class="headerlink" href="#methode-find" title="Permalink to this headline">¶</a></h3>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">find()</span></code> permet, à l’instar du <code class="docutils literal notranslate"><span class="pre">.find</span></code> en MongoDB (<a class="reference external" href="https://rtavenar.github.io/mongo_book/content/01_find.html">plus de précisions ici</a>), d’interroger une collection en filtrant les documents et les champs. De plus, cette méthode intègre la possibilité de limiter, trier et skiper les documents d’un résultat. Autrement dit, cette méthode comprends en ses arguments le <code class="docutils literal notranslate"><span class="pre">.limit</span></code>, le <code class="docutils literal notranslate"><span class="pre">.sort</span></code> et le <code class="docutils literal notranslate"><span class="pre">.skip</span></code> de MongoDB. Présentons alors les 5 arguments de cette méthode :</p>
<ul class="simple">
<li><p>query : correspond à la requête de filtrage des documents passée en premier agument d’un <code class="docutils literal notranslate"><span class="pre">.find</span></code> en MongoDB ; ‘{}’ est la valeur par défaut</p></li>
<li><p>fields : correspond à la requête de filtrage des champs passée en second argument d’un <code class="docutils literal notranslate"><span class="pre">.find</span></code> en MongoDB</p></li>
<li><p>sort : correspond à la requête de tri passée argument d’un <em>.sort</em> en MongoDB</p></li>
<li><p>limit : correspond à la requête de limitation du nombre de documents retournées, passée en argument d’un <code class="docutils literal notranslate"><span class="pre">.limit</span></code> en MongoDB</p></li>
<li><p>skip : correspond à la requête de choix d’une ligne de départ des documents retournées, passée en argument d’un <code class="docutils literal notranslate"><span class="pre">.skip</span></code> en MongoDB</p></li>
</ul>
<p>Comme nous avons pu l’énoncer précedémment, cette méthode stocke le résultat dans un dataframe sous R, prenant ainsi de la place en mémoire. Cette prise de place en mémoire peut être problématique, c’est pourquoi nous verrons par la suite l’intérêt de la méthode <code class="docutils literal notranslate"><span class="pre">iterate()</span></code> et de l’objet <em>Mongo iterator</em> qu’elle renvoie.</p>
<p><strong>Exemple :</strong></p>
<p>Regardons les 5 premières lignes du dataframe contenant les noms des restaurants chinois à Brooklyn triés par ordre alphabétique inverse (i.e, de Z à A) :</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">&lt;-</span> <span class="n">coll</span><span class="o">$</span><span class="nf">find</span><span class="p">(</span><span class="n">query</span> <span class="o">=</span> <span class="s">&#39;{&quot;cuisine&quot;:&quot;Chinese&quot;, &quot;borough&quot;:&quot;Brooklyn&quot;}&#39;</span><span class="p">,</span>
                  <span class="n">fields</span> <span class="o">=</span> <span class="s">&#39;{&quot;name&quot;: true, &quot;_id&quot;:false}&#39;</span><span class="p">,</span>
                  <span class="n">sort</span> <span class="o">=</span> <span class="s">&#39;{&quot;name&quot;:-1}&#39;</span><span class="p">,</span>
                  <span class="n">limit</span> <span class="o">=</span> <span class="m">5</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Found 5 records...
 Imported 5 records. Simplifying into dataframe...
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 5 × 1</caption>
<thead>
	<tr><th></th><th scope=col>name</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>Zhang'S Garden            </td></tr>
	<tr><th scope=row>2</th><td>Zhang'S Fortune Restaurant</td></tr>
	<tr><th scope=row>3</th><td>Zeng'S Restaurant         </td></tr>
	<tr><th scope=row>4</th><td>Yun Nan Flavour Garden    </td></tr>
	<tr><th scope=row>5</th><td>Yummy Yummy Kitchen       </td></tr>
</tbody>
</table>
</div></div>
</div>
<p>L’équivalent en MongoDB est le suivant :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="8603bbe5-8a51-4d14-98b9-b4e5c7a12a81" name="65a51bcd-30b6-48dc-8ce8-d246e11bf961" type="radio">
</input><label class="tabbed-label" for="8603bbe5-8a51-4d14-98b9-b4e5c7a12a81">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">&lt;-</span> <span class="n">coll</span><span class="o">$</span><span class="nf">find</span><span class="p">(</span><span class="n">query</span> <span class="o">=</span> <span class="s">&#39;{&quot;cuisine&quot;:&quot;Chinese&quot;, &quot;borough&quot;:&quot;Brooklyn&quot;}&#39;</span><span class="p">,</span>
                  <span class="n">fields</span> <span class="o">=</span> <span class="s">&#39;{&quot;name&quot;: true, &quot;_id&quot;:false}&#39;</span><span class="p">,</span>
                  <span class="n">sort</span> <span class="o">=</span> <span class="s">&#39;{&quot;name&quot;:-1}&#39;</span><span class="p">,</span>
                  <span class="n">limit</span> <span class="o">=</span> <span class="m">5</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<input id="996f3f46-c20c-459d-b515-84f4d017d77b" name="65a51bcd-30b6-48dc-8ce8-d246e11bf961" type="radio">
</input><label class="tabbed-label" for="996f3f46-c20c-459d-b515-84f4d017d77b">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">NYfood</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;cuisine&quot;</span><span class="o">:</span><span class="s2">&quot;Chinese&quot;</span><span class="p">,</span> <span class="s2">&quot;borough&quot;</span><span class="o">:</span><span class="s2">&quot;Brooklyn&quot;</span><span class="p">},</span> 
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">}).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">}).</span><span class="nx">limit</span><span class="p">(</span><span class="mf">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Rappelons que le tri par toute variable autre que l’identifiant peut être relativement lent, surtout lorsque la collection est de taille importante car seul l’identifiant est indexé. En ajoutant un index, le champ est pré-trié et son tri est presque immédiat. Pour ajouter un index avec <em>mongolite</em>, il suffit de le déclarer avec la méthode <code class="docutils literal notranslate"><span class="pre">index(add='{&quot;variable&quot;:1}')</span></code>.</p>
<p><strong>Exemple :</strong></p>
<p>Créer un index sur le champs <em>name</em> :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="c822d939-b11d-43e6-883d-7d9432958f80" name="d63d857c-900b-4789-9101-5443fa28019f" type="radio">
</input><label class="tabbed-label" for="c822d939-b11d-43e6-883d-7d9432958f80">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">coll</span><span class="o">$</span><span class="nf">index</span><span class="p">(</span><span class="n">add</span> <span class="o">=</span> <span class="s">&#39;{&quot;name&quot; : 1}&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="7504be3c-0691-4649-a355-cecbec0ab8cd" name="d63d857c-900b-4789-9101-5443fa28019f" type="radio">
</input><label class="tabbed-label" for="7504be3c-0691-4649-a355-cecbec0ab8cd">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">NYfood</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="mf">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Il est aussi possible de faire des requêtes textuelles avec mongolite. Toutefois attention, cela se fait obligatoirement à l’aide de l’opérateur <code class="docutils literal notranslate"><span class="pre">$regex</span></code>. En effet, avec <em>mongolite</em> on ne peut pas faire de requêtes textuelles à l’aide d’expressions régulières car le package permettant de convertir une chaîne de caractères en fichier JSON dans R ne connait pas les expressions régulières. Hormis ce détail, la syntaxe entre simples <em>quotes</em> est la même que pour les requêtes textuelles en MongoDB (<span class="xref myst">plus de précisions ici</span>).</p>
<p>Ainsi, pour afficher les 10 premiers restaurants de Manhattan dont le nom commence par la lettre ‘A’ par exemple, la requête adaptée est :</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="s">&#39;{&quot;borough&quot;: &quot;Manhattan&quot;, &quot;name&quot;: {&quot;$regex&quot;: &quot;^A&quot;, &quot;$options&quot;:&quot;i&quot;}}&#39;</span>
<span class="n">res</span> <span class="o">&lt;-</span> <span class="n">coll</span><span class="o">$</span><span class="nf">find</span><span class="p">(</span><span class="n">query</span> <span class="o">=</span> <span class="n">q</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Found 10 records...
 Imported 10 records. Simplifying into dataframe...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   address.building address.loc.type address.loc.coordinates
1                18            Point     -73.99698, 40.72589
2               146            Point     -73.99730, 40.71887
3               106            Point     -74.00033, 40.72749
4               101            Point     -73.97831, 40.76323
5               807            Point     -73.96643, 40.76417
6              1617            Point     -73.94785, 40.77548
7                              Point     -73.97911, 40.78348
8              1207            Point     -73.95926, 40.80886
9               463            Point       -73.9897, 40.7517
10              762            Point     -73.98820, 40.76414
        address.street address.zipcode   borough   cuisine
1  West Houston Street           10012 Manhattan American 
2      Mulberry Street           10013 Manhattan   Italian
3  West Houston Street           10012 Manhattan   Italian
4       West 55 Street           10019 Manhattan American 
5     Lexington Avenue           10065 Manhattan    Indian
6          York Avenue           10028 Manhattan   Italian
7          W 79 Street           10024 Manhattan American 
8     Amsterdam Avenue           10027 Manhattan American 
9             7 Avenue           10018 Manhattan American 
10            9 Avenue           10019 Manhattan   Mexican
                                                                                                            grades
1                                          1396483200, 1365120000, 1332288000, 1303862400, A, A, A, A, 9, 4, 13, 5
2                     1398988800, 1363219200, 1348617600, 1329264000, 1316044800, A, A, A, A, A, 11, 13, 9, 13, 11
3                     1396224000, 1381190400, 1364515200, 1346803200, 1330905600, A, A, A, A, A, 13, 12, 12, 7, 12
4                                           1413849600, 1392336000, 1357257600, 1326844800, A, A, A, A, 7, 9, 8, 7
5  1414454400, 1404864000, 1389916800, 1369699200, 1332806400, 1320192000, A, B, A, A, A, C, 10, 24, 11, 9, 13, 28
6                    1396396800, 1363132800, 1347408000, 1329782400, 1311120000, A, A, A, B, B, 13, 12, 13, 21, 21
7                     1399507200, 1378944000, 1360627200, 1319500800, 1306368000, A, A, A, A, A, 12, 11, 13, 3, 13
8                     1409702400, 1397779200, 1379980800, 1362960000, 1324339200, A, C, A, A, A, 12, 0, 10, 11, 12
9   1393545600, 1382313600, 1350518400, 1338854400, 1321315200, 1306454400, A, C, A, A, A, A, 12, 9, 13, 12, 9, 10
10                                                            1419811200, 1385942400, 1353888000, A, A, A, 9, 8, 5
                                            name restaurant_id
1                           Angelika Film Center      40362274
2                         Angelo Of Mulberry St.      40365293
3                                       Arturo&#39;S      40365387
4                               Astro Restaurant      40373113
5                                Agra Restaurant      40375376
6                                       Arturo&#39;S      40375616
7  American Museum Of Natural History Food Court      40376515
8            Amsterdam Restaurant &amp; Tapas Lounge      40377111
9                            Andrews Coffee Shop      40378579
10                                 Arriba Arriba      40380457
</pre></div>
</div>
</div>
</div>
<p>Notons alors l’équivalent possible en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="830915f1-87ff-4bd5-8cea-2f995c93a87d" name="3d3c8a74-8e72-4458-928c-9d6cd57ae5ea" type="radio">
</input><label class="tabbed-label" for="830915f1-87ff-4bd5-8cea-2f995c93a87d">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="s">&#39;{&quot;borough&quot;: &quot;Manhattan&quot;, &quot;name&quot;: {&quot;$regex&quot;: &quot;^A&quot;, &quot;$options&quot;:&quot;i&quot;}}&#39;</span>
<span class="n">coll</span><span class="o">$</span><span class="nf">find</span><span class="p">(</span><span class="n">query</span> <span class="o">=</span> <span class="n">q</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="1f2e0266-fd75-4d0d-ab6c-76dc27458fd9" name="3d3c8a74-8e72-4458-928c-9d6cd57ae5ea" type="radio">
</input><label class="tabbed-label" for="1f2e0266-fd75-4d0d-ab6c-76dc27458fd9">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">NYfood</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;borough&quot;</span><span class="o">:</span> <span class="s2">&quot;Manhattan&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="sr">/^A/i</span> <span class="p">}).</span><span class="nx">limit</span><span class="p">(</span><span class="mf">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-remarque admonition">
<p class="admonition-title">Remarque</p>
<p>Comme en NoSQL, l’accent circonflèxe sert à préciser que seulement les chaînes commençant par la lettre A seront acceptées. L’opérateur <code class="docutils literal notranslate"><span class="pre">&quot;$options&quot;:&quot;i&quot;</span></code> précise que la casse n’est pas importante (i.e, la chaine “abc” sera jugée acceptable).</p>
</div>
<hr class="docutils" />
<p>Pour ce qui est des requêtes géospatiales, la syntaxe entre simples <em>quotes</em> est la même que pour les requêtes géo-spatiales en MongoDB (<span class="xref myst">plus de précisions ici</span>).</p>
</div>
<div class="section" id="methode-iterate">
<h3><span class="section-number">7.2.2.3. </span>Méthode iterate<a class="headerlink" href="#methode-iterate" title="Permalink to this headline">¶</a></h3>
<p>Nous avons vu précedemment que le renvoi d’une requête dans un dataframe R à l’aide de la méthode <code class="docutils literal notranslate"><span class="pre">find()</span></code> pouvait être problématique pour de grands volumes de données. La méthode <code class="docutils literal notranslate"><span class="pre">iterate()</span></code> permet de s’affranchir de ce problème. Celle-ci fonctionne exactement de la même manière que la méthode <code class="docutils literal notranslate"><span class="pre">find()</span></code> mais renvoie le résultat d’une requête non pas dans un dataframe mais dans un objet propre à <em>mongolite</em>, un <em>Mongo iterator</em>. Cet objet va permettre de ne pas stocker toutes les documents de la requête en mémoire mais de les lire un par un. Pour ce faire, il existe 4 méthodes applicables à un <em>Mongo iterator</em> :</p>
<ul class="simple">
<li><p>batch(n) : permet de parcourir n documents à la fois</p></li>
<li><p>json() : retourne les résultats de la requête dans un format JSON</p></li>
<li><p>one() : permet de parcourir un document à la fois</p></li>
<li><p>page() : retourne les résultats de la requête sous forme de dataframe</p></li>
</ul>
<p>Lorsque l’itérateur a épuisé tous les résultats de la collection, il retourne la valeur vide (NULL).</p>
<p><strong>Exemple :</strong></p>
<p>La création d’un itérateur sur l’ensemble de la collection NYfood se fait comme ci-dessous :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">it</span> <span class="o">&lt;-</span> <span class="n">coll</span><span class="o">$</span><span class="nf">iterate</span><span class="p">()</span>
<span class="n">it</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Mongo iterator&gt; 
 $batch(size = 1000) 
 $json(size = 1000) 
 $one() 
 $page(size = 1000) 
</pre></div>
</div>
</div>
</div>
<p>Affichons par exemple les 5 premières lignes :</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">it</span><span class="o">$</span><span class="nf">batch</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1]]
[[1]]$address
[[1]]$address$building
[1] &quot;469&quot;

[[1]]$address$loc
[[1]]$address$loc$type
[1] &quot;Point&quot;

[[1]]$address$loc$coordinates
[[1]]$address$loc$coordinates[[1]]
[1] -73.9617

[[1]]$address$loc$coordinates[[2]]
[1] 40.66294



[[1]]$address$street
[1] &quot;Flatbush Avenue&quot;

[[1]]$address$zipcode
[1] &quot;11225&quot;


[[1]]$borough
[1] &quot;Brooklyn&quot;

[[1]]$cuisine
[1] &quot;Hamburgers&quot;

[[1]]$grades
[[1]]$grades[[1]]
[[1]]$grades[[1]]$date
[1] &quot;2014-12-30 UTC&quot;

[[1]]$grades[[1]]$grade
[1] &quot;A&quot;

[[1]]$grades[[1]]$score
[1] 8


[[1]]$grades[[2]]
[[1]]$grades[[2]]$date
[1] &quot;2014-07-01 UTC&quot;

[[1]]$grades[[2]]$grade
[1] &quot;B&quot;

[[1]]$grades[[2]]$score
[1] 23


[[1]]$grades[[3]]
[[1]]$grades[[3]]$date
[1] &quot;2013-04-30 UTC&quot;

[[1]]$grades[[3]]$grade
[1] &quot;A&quot;

[[1]]$grades[[3]]$score
[1] 12


[[1]]$grades[[4]]
[[1]]$grades[[4]]$date
[1] &quot;2012-05-08 UTC&quot;

[[1]]$grades[[4]]$grade
[1] &quot;A&quot;

[[1]]$grades[[4]]$score
[1] 12



[[1]]$name
[1] &quot;Wendy&#39;S&quot;

[[1]]$restaurant_id
[1] &quot;30112340&quot;


[[2]]
[[2]]$address
[[2]]$address$building
[1] &quot;1007&quot;

[[2]]$address$loc
[[2]]$address$loc$type
[1] &quot;Point&quot;

[[2]]$address$loc$coordinates
[[2]]$address$loc$coordinates[[1]]
[1] -73.85608

[[2]]$address$loc$coordinates[[2]]
[1] 40.84845



[[2]]$address$street
[1] &quot;Morris Park Ave&quot;

[[2]]$address$zipcode
[1] &quot;10462&quot;


[[2]]$borough
[1] &quot;Bronx&quot;

[[2]]$cuisine
[1] &quot;Bakery&quot;

[[2]]$grades
[[2]]$grades[[1]]
[[2]]$grades[[1]]$date
[1] &quot;2014-03-03 UTC&quot;

[[2]]$grades[[1]]$grade
[1] &quot;A&quot;

[[2]]$grades[[1]]$score
[1] 2


[[2]]$grades[[2]]
[[2]]$grades[[2]]$date
[1] &quot;2013-09-11 UTC&quot;

[[2]]$grades[[2]]$grade
[1] &quot;A&quot;

[[2]]$grades[[2]]$score
[1] 6


[[2]]$grades[[3]]
[[2]]$grades[[3]]$date
[1] &quot;2013-01-24 UTC&quot;

[[2]]$grades[[3]]$grade
[1] &quot;A&quot;

[[2]]$grades[[3]]$score
[1] 10


[[2]]$grades[[4]]
[[2]]$grades[[4]]$date
[1] &quot;2011-11-23 UTC&quot;

[[2]]$grades[[4]]$grade
[1] &quot;A&quot;

[[2]]$grades[[4]]$score
[1] 9


[[2]]$grades[[5]]
[[2]]$grades[[5]]$date
[1] &quot;2011-03-10 UTC&quot;

[[2]]$grades[[5]]$grade
[1] &quot;B&quot;

[[2]]$grades[[5]]$score
[1] 14



[[2]]$name
[1] &quot;Morris Park Bake Shop&quot;

[[2]]$restaurant_id
[1] &quot;30075445&quot;


[[3]]
[[3]]$address
[[3]]$address$building
[1] &quot;351&quot;

[[3]]$address$loc
[[3]]$address$loc$type
[1] &quot;Point&quot;

[[3]]$address$loc$coordinates
[[3]]$address$loc$coordinates[[1]]
[1] -73.98514

[[3]]$address$loc$coordinates[[2]]
[1] 40.76769



[[3]]$address$street
[1] &quot;West   57 Street&quot;

[[3]]$address$zipcode
[1] &quot;10019&quot;


[[3]]$borough
[1] &quot;Manhattan&quot;

[[3]]$cuisine
[1] &quot;Irish&quot;

[[3]]$grades
[[3]]$grades[[1]]
[[3]]$grades[[1]]$date
[1] &quot;2014-09-06 UTC&quot;

[[3]]$grades[[1]]$grade
[1] &quot;A&quot;

[[3]]$grades[[1]]$score
[1] 2


[[3]]$grades[[2]]
[[3]]$grades[[2]]$date
[1] &quot;2013-07-22 UTC&quot;

[[3]]$grades[[2]]$grade
[1] &quot;A&quot;

[[3]]$grades[[2]]$score
[1] 11


[[3]]$grades[[3]]
[[3]]$grades[[3]]$date
[1] &quot;2012-07-31 UTC&quot;

[[3]]$grades[[3]]$grade
[1] &quot;A&quot;

[[3]]$grades[[3]]$score
[1] 12


[[3]]$grades[[4]]
[[3]]$grades[[4]]$date
[1] &quot;2011-12-29 UTC&quot;

[[3]]$grades[[4]]$grade
[1] &quot;A&quot;

[[3]]$grades[[4]]$score
[1] 12



[[3]]$name
[1] &quot;Dj Reynolds Pub And Restaurant&quot;

[[3]]$restaurant_id
[1] &quot;30191841&quot;


[[4]]
[[4]]$address
[[4]]$address$building
[1] &quot;2780&quot;

[[4]]$address$loc
[[4]]$address$loc$type
[1] &quot;Point&quot;

[[4]]$address$loc$coordinates
[[4]]$address$loc$coordinates[[1]]
[1] -73.98242

[[4]]$address$loc$coordinates[[2]]
[1] 40.5795



[[4]]$address$street
[1] &quot;Stillwell Avenue&quot;

[[4]]$address$zipcode
[1] &quot;11224&quot;


[[4]]$borough
[1] &quot;Brooklyn&quot;

[[4]]$cuisine
[1] &quot;American &quot;

[[4]]$grades
[[4]]$grades[[1]]
[[4]]$grades[[1]]$date
[1] &quot;2014-06-10 UTC&quot;

[[4]]$grades[[1]]$grade
[1] &quot;A&quot;

[[4]]$grades[[1]]$score
[1] 5


[[4]]$grades[[2]]
[[4]]$grades[[2]]$date
[1] &quot;2013-06-05 UTC&quot;

[[4]]$grades[[2]]$grade
[1] &quot;A&quot;

[[4]]$grades[[2]]$score
[1] 7


[[4]]$grades[[3]]
[[4]]$grades[[3]]$date
[1] &quot;2012-04-13 UTC&quot;

[[4]]$grades[[3]]$grade
[1] &quot;A&quot;

[[4]]$grades[[3]]$score
[1] 12


[[4]]$grades[[4]]
[[4]]$grades[[4]]$date
[1] &quot;2011-10-12 UTC&quot;

[[4]]$grades[[4]]$grade
[1] &quot;A&quot;

[[4]]$grades[[4]]$score
[1] 12



[[4]]$name
[1] &quot;Riviera Caterer&quot;

[[4]]$restaurant_id
[1] &quot;40356018&quot;


[[5]]
[[5]]$address
[[5]]$address$building
[1] &quot;97-22&quot;

[[5]]$address$loc
[[5]]$address$loc$type
[1] &quot;Point&quot;

[[5]]$address$loc$coordinates
[[5]]$address$loc$coordinates[[1]]
[1] -73.86012

[[5]]$address$loc$coordinates[[2]]
[1] 40.73117



[[5]]$address$street
[1] &quot;63 Road&quot;

[[5]]$address$zipcode
[1] &quot;11374&quot;


[[5]]$borough
[1] &quot;Queens&quot;

[[5]]$cuisine
[1] &quot;Jewish/Kosher&quot;

[[5]]$grades
[[5]]$grades[[1]]
[[5]]$grades[[1]]$date
[1] &quot;2014-11-24 UTC&quot;

[[5]]$grades[[1]]$grade
[1] &quot;Z&quot;

[[5]]$grades[[1]]$score
[1] 20


[[5]]$grades[[2]]
[[5]]$grades[[2]]$date
[1] &quot;2013-01-17 UTC&quot;

[[5]]$grades[[2]]$grade
[1] &quot;A&quot;

[[5]]$grades[[2]]$score
[1] 13


[[5]]$grades[[3]]
[[5]]$grades[[3]]$date
[1] &quot;2012-08-02 UTC&quot;

[[5]]$grades[[3]]$grade
[1] &quot;A&quot;

[[5]]$grades[[3]]$score
[1] 13


[[5]]$grades[[4]]
[[5]]$grades[[4]]$date
[1] &quot;2011-12-15 UTC&quot;

[[5]]$grades[[4]]$grade
[1] &quot;B&quot;

[[5]]$grades[[4]]$score
[1] 25



[[5]]$name
[1] &quot;Tov Kosher Kitchen&quot;

[[5]]$restaurant_id
[1] &quot;40356068&quot;
</pre></div>
</div>
</div>
</div>
<p>L’affichage avec la méthode batch, qui est essentiellement des listes imbriquées, n’est pas toujours facile à visualiser et nous pouvons décider de stocker le résultat dans un dataframe pour mieux le visualiser ; cela se fait avec la méthode <code class="docutils literal notranslate"><span class="pre">page()</span></code>. Par exemple, pour stocker les 5 premières lignes dans un dataframe :</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">it</span><span class="o">$</span><span class="nf">page</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  address.building address.loc.type address.loc.coordinates    address.street
1             2206            Point     -74.13773, 40.61196 Victory Boulevard
2             8825            Point     -73.88038, 40.76431 Astoria Boulevard
3             7114            Point     -73.90685, 40.61990          Avenue U
4             6409            Point     -74.00529, 40.62889         11 Avenue
5             1839            Point     -73.94826, 40.64083   Nostrand Avenue
  address.zipcode       borough                         cuisine
1           10314 Staten Island                   Jewish/Kosher
2           11369        Queens                       American 
3           11234      Brooklyn                    Delicatessen
4           11219      Brooklyn                       American 
5           11226      Brooklyn Ice Cream, Gelato, Yogurt, Ices
                                                                                                          grades
1                                       1412553600, 1400544000, 1365033600, 1327363200, A, A, A, A, 9, 12, 12, 9
2                                      1416009600, 1398988800, 1362182400, 1328832000, Z, A, A, A, 38, 10, 7, 13
3 1401321600, 1389657600, 1375488000, 1342569600, 1331251200, 1318550400, A, A, A, A, A, A, 10, 10, 8, 10, 13, 9
4                   1405641600, 1375142400, 1360713600, 1345075200, 1313539200, A, A, A, A, A, 12, 12, 11, 2, 11
5                                        1405296000, 1373414400, 1341964800, 1329955200, A, A, A, A, 12, 8, 5, 8
                         name restaurant_id
1               Kosher Island      40356442
2     Brunos On The Boulevard      40356151
3          Wilken&#39;S Fine Food      40356483
4             Regina Caterers      40356649
5 Taste The Tropics Ice Cream      40356731
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="methode-distinct">
<h3><span class="section-number">7.2.2.4. </span>Méthode distinct<a class="headerlink" href="#methode-distinct" title="Permalink to this headline">¶</a></h3>
<p>Tout comme le <code class="docutils literal notranslate"><span class="pre">.distinct()</span></code> en MongoDB (<span class="xref myst">plus de précisions ici</span>), la méthode <code class="docutils literal notranslate"><span class="pre">distinct()</span></code> nous renvoie les valeurs distinctes d’un champ.</p>
<p><strong>Exemple :</strong></p>
<p>Affichez la liste des notes existant dans la base :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">coll</span><span class="o">$</span><span class="nf">distinct</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&quot;grades.grade&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'A'</li><li>'B'</li><li>'C'</li><li>'Not Yet Graded'</li><li>'P'</li><li>'Z'</li></ol>
</div></div>
</div>
<p>Nous pouvons également noter l’équivalent en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="65af9cc5-ba04-4d45-bcf5-4df5b234113c" name="5260457b-48ad-43f3-97b1-be132a0cab15" type="radio">
</input><label class="tabbed-label" for="65af9cc5-ba04-4d45-bcf5-4df5b234113c">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">coll</span><span class="o">$</span><span class="nf">distinct</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&quot;grades.grade&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="39e93fbf-e5fe-4ad5-a388-4198972520a4" name="5260457b-48ad-43f3-97b1-be132a0cab15" type="radio">
</input><label class="tabbed-label" for="39e93fbf-e5fe-4ad5-a388-4198972520a4">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">NYfood</span><span class="p">.</span><span class="nx">distinct</span><span class="p">(</span><span class="s2">&quot;grades.grade&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="selectionner-par-date">
<h3><span class="section-number">7.2.2.5. </span>Sélectionner par date<a class="headerlink" href="#selectionner-par-date" title="Permalink to this headline">¶</a></h3>
<p>Le traitement des dates avec <em>mongolite</em> mérite une attention particulière. En effet, lorsque l’on souhaite intéragir avec une collection sur un champ de type <em>date</em>, la syntaxe sera relativement différente de celle que l’on peut utiliser en <em>MongoDB</em> (<a class="reference external" href="https://rtavenar.github.io/mongo_book/content/03_dates.html">plus de précisions ici</a>) ou avec <em>pymongo</em>. En raison de la classe d’une requête en mongolite (chaîne de caractère), on ne pourra pas utiliser d’objet R spécifique aux dates (comme les datetimes en python par exemple). Ainsi, toutes les dates définies dans une requête en mongolite devront être spécifiées dans un format purement JSON intégrant un opérateur <code class="docutils literal notranslate"><span class="pre">$date</span></code> et une syntaxe UTC. Concrètement, ce format sera du type :</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;$date&quot;</span> <span class="o">:</span> <span class="s2">&quot;AAAA-MM-JJThh:mm:ssZ&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p><strong>Exemple :</strong></p>
<p>Prenons un exemple en affichant la liste des 10 premiers restaurants ayant eu au moins une note postérieure au 20 janvier 2015 :</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">&lt;-</span> <span class="s">&#39;{&quot;grades.date&quot;: {&quot;$gte&quot;: {&quot;$date&quot;: &quot;2015-01-20T00:00:00Z&quot;}}}&#39;</span>
<span class="n">data</span> <span class="o">&lt;-</span> <span class="n">coll</span><span class="o">$</span><span class="nf">find</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Found 10 records...
 Imported 10 records. Simplifying into dataframe...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   address.building address.loc.type address.loc.coordinates   address.street
1               730            Point     -73.89955, 40.81644     Kelly Street
2               968            Point     -92.72302, 41.74614         6 Avenue
3              1285            Point     -73.92275, 40.83945  Shakespeare Ave
4               416            Point     -73.95136, 40.77249 East   80 Street
5               725            Point     -74.01381, 40.63368        65 Street
6           229-231            Point     -74.00155, 40.70780     Front Street
7            263-15            Point     -73.70923, 40.74883   Union Turnpike
8               353            Point     -73.98533, 40.76794 West   57 Street
9               413            Point     -73.86476, 40.90232 East  241 Street
10              590            Point     -73.92636, 40.81950  Grand Concourse
   address.zipcode   borough   cuisine
1            10455     Bronx American 
2            10018 Manhattan American 
3            10452     Bronx   Spanish
4            10075 Manhattan American 
5            11220  Brooklyn     Other
6            10038 Manhattan American 
7            11004    Queens American 
8            10019 Manhattan American 
9            10470     Bronx American 
10           10451     Bronx   African
                                                                                                                        grades
1                                                                                                1421712000, Not Yet Graded, 4
2  1421712000, 1396915200, 1380585600, 1360713600, 1345075200, 1330041600, Not Yet Graded, A, A, B, A, A, 17, 9, 13, 27, 9, 11
3                                                                                               1421712000, Not Yet Graded, 12
4                                                                                                1421712000, Not Yet Graded, 9
5                                                                                               1421712000, Not Yet Graded, NA
6                                                                                                1421712000, Not Yet Graded, 2
7                                                                                                1421712000, Not Yet Graded, 7
8                                                                                               1421712000, Not Yet Graded, 24
9                                          1421712000, 1383523200, 1367280000, 1318982400, Not Yet Graded, A, A, A, 4, 2, 9, 9
10                                                                                              1421712000, Not Yet Graded, 21
                                                 name restaurant_id
1                                    Ambassador Diner      40403946
2                                Herald Square Market      40984099
3                         El Nuevo Encuentro Bar Corp      41185949
4                    Caedmon School Winstead Caterers      41243754
5                               Swedish Football Club      41278206
6                                                Onda      41338998
7                                          Saint Anns      41433190
8                                          Good Units      41514954
9  Homestyle Food Services (St. Barnabas High School)      41519329
10                              Capitol International      41650465
</pre></div>
</div>
</div>
</div>
<p>Nous pouvons noter l’équivalent en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="16e867c9-ecc7-4532-9bb2-98ce7323f05f" name="e838234e-31e8-4758-ad89-55d8f768a71d" type="radio">
</input><label class="tabbed-label" for="16e867c9-ecc7-4532-9bb2-98ce7323f05f">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">&lt;-</span> <span class="s">&#39;{&quot;grades.date&quot;: {&quot;$gte&quot;: {&quot;$date&quot;: &quot;2015-01-20T00:00:00Z&quot;}}}&#39;</span>
<span class="n">data</span> <span class="o">&lt;-</span> <span class="n">coll</span><span class="o">$</span><span class="nf">find</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<input id="6dd0a42c-2418-4a8d-b5ed-bc6754d9248d" name="e838234e-31e8-4758-ad89-55d8f768a71d" type="radio">
</input><label class="tabbed-label" for="6dd0a42c-2418-4a8d-b5ed-bc6754d9248d">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s2">&quot;2015-01-20&quot;</span><span class="p">)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">NYfood</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;grades.date&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">$gte</span><span class="o">:</span> <span class="nx">date</span><span class="p">}}).</span><span class="nx">limit</span><span class="p">(</span><span class="mf">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="aggregations">
<h2><span class="section-number">7.2.3. </span>Aggrégations<a class="headerlink" href="#aggregations" title="Permalink to this headline">¶</a></h2>
<p>Nous nous proposons dans ce paragraphe de traiter de la méthode <code class="docutils literal notranslate"><span class="pre">aggregate()</span></code> de mongolite qui permet d’éxécuter, à l’instar de d’un <code class="docutils literal notranslate"><span class="pre">.aggregate</span></code> en MongoDB, une pipeline d’aggrégation qui n’est rien d’autre qu’une succession de plusieurs étapes d’aggrégation. La méthode <code class="docutils literal notranslate"><span class="pre">aggregate()</span></code> prend comme argument une liste de dictionnaires que l’on met entre simples <em>quotes</em>. La syntaxe a utiliser pour cette liste de dictionnaires est la même que pour le <code class="docutils literal notranslate"><span class="pre">.aggregate</span></code> de MongoDB (nous vous renvoyons au chapitre sur <span class="xref myst">les requêtes d’aggrégations</span> pour plus de précisions). Tout comme la méthode <code class="docutils literal notranslate"><span class="pre">find()</span></code>, la méthode aggregate renvoie un <em>dataframe</em>.</p>
<p><strong>Exemple :</strong></p>
<p>Prenons un exemple : dans la collection NYfood, le pipeline ci-dessous retourne le nombre de restaurants par arrondissement (borough).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">req</span> <span class="o">=</span> <span class="s">&#39;[{&quot;$group&quot;:{&quot;_id&quot;:&quot;$borough&quot;,&quot;nb_restos&quot;:{&quot;$sum&quot;:1}}}]&#39;</span> 
<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">coll</span><span class="o">$</span><span class="nf">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="o">=</span><span class="n">req</span><span class="p">)</span> 
<span class="n">df</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Found 6 records...
 Imported 6 records. Simplifying into dataframe...
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 2</caption>
<thead>
	<tr><th></th><th scope=col>_id</th><th scope=col>nb_restos</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>Missing      </td><td>   51</td></tr>
	<tr><th scope=row>2</th><td>Manhattan    </td><td>10258</td></tr>
	<tr><th scope=row>3</th><td>Bronx        </td><td> 2338</td></tr>
	<tr><th scope=row>4</th><td>Queens       </td><td> 5656</td></tr>
	<tr><th scope=row>5</th><td>Staten Island</td><td>  969</td></tr>
	<tr><th scope=row>6</th><td>Brooklyn     </td><td> 6085</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Nous pouvons noter l’équivalent en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="a8d0c2f2-a7c9-41cd-b6a3-a0088dda3cb4" name="d08e9243-38fb-465a-999b-0a127e4a69b5" type="radio">
</input><label class="tabbed-label" for="a8d0c2f2-a7c9-41cd-b6a3-a0088dda3cb4">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">req</span> <span class="o">=</span> <span class="s">&#39;[{&quot;$group&quot;:{&quot;_id&quot;:&quot;$borough&quot;,&quot;nb_restos&quot;:{&quot;$sum&quot;:1}}}]&#39;</span> 
<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">coll</span><span class="o">$</span><span class="nf">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="o">=</span><span class="n">req</span><span class="p">)</span> 
<span class="n">df</span> 
</pre></div>
</div>
</div>
<input id="e27ecd30-d6a0-4824-8ece-eedc6974a925" name="d08e9243-38fb-465a-999b-0a127e4a69b5" type="radio">
</input><label class="tabbed-label" for="e27ecd30-d6a0-4824-8ece-eedc6974a925">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">NYfood</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;$borough&quot;</span><span class="p">,</span> <span class="s2">&quot;nb_restos&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;$sum&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">}}}])</span>
</pre></div>
</div>
</div>
</div>
<p>Il se peut que le dataframe à retourner soit de taille importante (ce n’est pas le cas ici). Pour éviter tout problème de saturation de mémoire, il est préférable d’effectuer l’aggrégation avec l’option <code class="docutils literal notranslate"><span class="pre">iterate=TRUE</span></code>. Ainsi, la méthode <code class="docutils literal notranslate"><span class="pre">aggregate()</span></code> renvoie comme pour la méthode <code class="docutils literal notranslate"><span class="pre">iterate()</span></code> un <em>Mongo iterator</em>. Toutes les méthodes applicables à un <em>Mongo iterator</em> présentées précédemment s’appliqueront alors à l’objet renvoyé par la méthode <code class="docutils literal notranslate"><span class="pre">aggregate()</span></code>. Pour reprendre l’exemple ci-dessus :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">req</span> <span class="o">=</span> <span class="s">&#39;[{&quot;$group&quot;:{&quot;_id&quot;:&quot;$borough&quot;,&quot;nb_restos&quot;:{&quot;$sum&quot;:1}}}]&#39;</span> 
<span class="n">it</span> <span class="o">&lt;-</span> <span class="n">coll</span><span class="o">$</span><span class="nf">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="o">=</span><span class="n">req</span><span class="p">,</span> <span class="n">iterate</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> 
<span class="n">it</span><span class="o">$</span><span class="nf">page</span><span class="p">(</span><span class="m">2</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 2 × 2</caption>
<thead>
	<tr><th></th><th scope=col>_id</th><th scope=col>nb_restos</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>Missing  </td><td>   51</td></tr>
	<tr><th scope=row>2</th><td>Manhattan</td><td>10258</td></tr>
</tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="manipulation-de-donnees">
<h2><span class="section-number">7.2.4. </span>Manipulation de données<a class="headerlink" href="#manipulation-de-donnees" title="Permalink to this headline">¶</a></h2>
<div class="section" id="methode-insert">
<h3><span class="section-number">7.2.4.1. </span>Méthode insert<a class="headerlink" href="#methode-insert" title="Permalink to this headline">¶</a></h3>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">insert()</span></code> permet, à l’instar du <code class="docutils literal notranslate"><span class="pre">.insert</span></code> en MongoDB (<span class="xref myst">plus de précisions ici</span>), d’ajouter des données à une collection.
La méthode la plus simple, est d’insérer des données à partir d’un data frame R. Les colonnes du data frame seront automatiquement transformées en clées d’enregistrement JSON.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">&lt;-</span> <span class="nf">mongo</span><span class="p">()</span>
<span class="n">test</span><span class="o">$</span><span class="nf">drop</span><span class="p">()</span>
<span class="n">test</span><span class="o">$</span><span class="nf">insert</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>List of 5
 $ nInserted  : num 150
 $ nMatched   : num 0
 $ nRemoved   : num 0
 $ nUpserted  : num 0
 $ writeErrors: list()
</pre></div>
</div>
</div>
</div>
<div class="admonition-remarque admonition">
<p class="admonition-title">Remarque</p>
<p>En pratique, c’est l’inverse de <code class="docutils literal notranslate"><span class="pre">mongo$find()</span></code> qui converti la collection en Data Frame.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">$</span><span class="nf">find</span><span class="p">(</span><span class="n">limit</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 5</caption>
<thead>
	<tr><th></th><th scope=col>Sepal_Length</th><th scope=col>Sepal_Width</th><th scope=col>Petal_Length</th><th scope=col>Petal_Width</th><th scope=col>Species</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>5.1</td><td>3.5</td><td>1.4</td><td>0.2</td><td>setosa</td></tr>
	<tr><th scope=row>2</th><td>4.9</td><td>3.0</td><td>1.4</td><td>0.2</td><td>setosa</td></tr>
	<tr><th scope=row>3</th><td>4.7</td><td>3.2</td><td>1.3</td><td>0.2</td><td>setosa</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Il est également possible d’insérer directement des données à partir d’une chaîne de caractère JSON. Cette méthode nécessite un vecteur de caractères où chaque élément est une chaîne JSON valide.<br />
A noter qu’ici la méthode <code class="docutils literal notranslate"><span class="pre">insert()</span></code> crée la collection “individus” car cette dernière n’existe pas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span> <span class="o">&lt;-</span> <span class="nf">mongo</span><span class="p">(</span><span class="s">&quot;individus&quot;</span><span class="p">)</span>
<span class="n">str</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;{&quot;prenom&quot; : &quot;yolan&quot;}&#39;</span> <span class="p">,</span> <span class="s">&#39;{&quot;prenom&quot;: &quot;paul&quot;, &quot;age&quot; : 22}&#39;</span><span class="p">,</span> <span class="s">&#39;{&quot;prenom&quot;: &quot;faisal&quot;}&#39;</span><span class="p">)</span>
<span class="n">individus</span><span class="o">$</span><span class="nf">insert</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>List of 6
 $ nInserted  : int 3
 $ nMatched   : int 0
 $ nModified  : int 0
 $ nRemoved   : int 0
 $ nUpserted  : int 0
 $ writeErrors: list()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">find</span><span class="p">(</span><span class="n">query</span> <span class="o">=</span> <span class="s">&#39;{}&#39;</span><span class="p">,</span> <span class="n">fields</span> <span class="o">=</span> <span class="s">&#39;{}&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 3</caption>
<thead>
	<tr><th></th><th scope=col>_id</th><th scope=col>prenom</th><th scope=col>age</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>608a72ce9ab7a318946cb8f9</td><td>yolan </td><td>NA</td></tr>
	<tr><th scope=row>2</th><td>608a72ce9ab7a318946cb8fa</td><td>paul  </td><td>22</td></tr>
	<tr><th scope=row>3</th><td>608a72ce9ab7a318946cb8fb</td><td>faisal</td><td>NA</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Nous pouvons également noter l’équivalent en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="210e83b6-125a-49bc-a737-61916ddfdc19" name="92580919-b40d-41b8-892a-dfed4e27bbd7" type="radio">
</input><label class="tabbed-label" for="210e83b6-125a-49bc-a737-61916ddfdc19">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span> <span class="o">&lt;-</span> <span class="nf">mongo</span><span class="p">(</span><span class="s">&quot;individus&quot;</span><span class="p">)</span>
<span class="n">individus</span><span class="o">$</span><span class="nf">insert</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;{&quot;prenom&quot; : &quot;yolan&quot;}&#39;</span> <span class="p">,</span> <span class="s">&#39;{&quot;prenom&quot;: &quot;paul&quot;, &quot;age&quot; : 22}&#39;</span><span class="p">,</span> <span class="s">&#39;{&quot;prenom&quot;: &quot;faisal&quot;}&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<input id="4fece895-b379-47a7-bbed-edfa30c69c73" name="92580919-b40d-41b8-892a-dfed4e27bbd7" type="radio">
</input><label class="tabbed-label" for="4fece895-b379-47a7-bbed-edfa30c69c73">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>db.createCollection(&quot;individus&quot;)
db.individus.insert([
{&quot;prenom&quot; : &quot;yolan&quot;}&#39;,
{&quot;prenom&quot;: &quot;paul&quot;, &quot;age&quot; : 22},
{&quot;prenom&quot;: &quot;faisal&quot;}
])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="methode-remove">
<h3><span class="section-number">7.2.4.2. </span>Méthode remove<a class="headerlink" href="#methode-remove" title="Permalink to this headline">¶</a></h3>
<p>La même syntaxe que nous utilisons dans <code class="docutils literal notranslate"><span class="pre">find()</span></code> pour sélectionner les enregistrements à lire, peut également être utilisée pour sélectionner les enregistrements à supprimer :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">$</span><span class="nf">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">150</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">$</span><span class="nf">remove</span><span class="p">(</span><span class="s">&#39;{&quot;Species&quot; : &quot;setosa&quot;}&#39;</span><span class="p">)</span>
<span class="n">test</span><span class="o">$</span><span class="nf">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">100</div></div>
</div>
<p>Nous pouvons noter l’équivalent en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="b88f16df-fb04-44cd-9d09-ea39232128f8" name="f8feebba-64df-4188-9c28-a2463f6a202a" type="radio">
</input><label class="tabbed-label" for="b88f16df-fb04-44cd-9d09-ea39232128f8">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">$</span><span class="nf">remove</span><span class="p">(</span><span class="s">&#39;{&quot;Species&quot; : &quot;setosa&quot;}&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="cd9f3fb2-0e91-4ecf-8c24-acd7659eabd2" name="f8feebba-64df-4188-9c28-a2463f6a202a" type="radio">
</input><label class="tabbed-label" for="cd9f3fb2-0e91-4ecf-8c24-acd7659eabd2">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span>
<span class="p">{</span><span class="s2">&quot;Species&quot;</span> <span class="o">:</span> <span class="s2">&quot;setosa&quot;</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Utilisez l’option just_one pour supprimer un seul enregistrement :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">$</span><span class="nf">remove</span><span class="p">(</span><span class="s">&#39;{&quot;Sepal_Length&quot; : {&quot;$lte&quot; : 5}}&#39;</span><span class="p">,</span> <span class="n">just_one</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="n">test</span><span class="o">$</span><span class="nf">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">99</div></div>
</div>
<p>Pour supprimer tous les documents de la collection (mais pas la collection elle-même) :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">$</span><span class="nf">remove</span><span class="p">(</span><span class="s">&#39;{}&#39;</span><span class="p">)</span>
<span class="n">test</span><span class="o">$</span><span class="nf">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0</div></div>
</div>
<p>Nous pouvons noter l’équivalent en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="230ed7da-4649-4b41-8589-940840af0826" name="38a3103c-160b-4bfe-a851-6afd6d03e04c" type="radio">
</input><label class="tabbed-label" for="230ed7da-4649-4b41-8589-940840af0826">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">$</span><span class="nf">remove</span><span class="p">(</span><span class="s">&#39;{}&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="10fcd84a-4e0f-4aea-8704-4a68904f7f18" name="38a3103c-160b-4bfe-a851-6afd6d03e04c" type="radio">
</input><label class="tabbed-label" for="10fcd84a-4e0f-4aea-8704-4a68904f7f18">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">remove</span><span class="p">({})</span>
</pre></div>
</div>
</div>
</div>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">drop()</span></code> supprime une collection entière. Cela inclut toutes les documents, ainsi que les métadonnées telles que les index de la collection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">$</span><span class="nf">drop</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Nous pouvons noter l’équivalent en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="45a93520-94d5-4121-a40b-7a5b3ba7a260" name="542863ec-f2d2-4a64-a248-48f549477072" type="radio">
</input><label class="tabbed-label" for="45a93520-94d5-4121-a40b-7a5b3ba7a260">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">$</span><span class="nf">drop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<input id="f203ba46-2663-4895-8ff2-e8be3fc98680" name="542863ec-f2d2-4a64-a248-48f549477072" type="radio">
</input><label class="tabbed-label" for="f203ba46-2663-4895-8ff2-e8be3fc98680">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">drop</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="methodes-update-upsert">
<h3><span class="section-number">7.2.4.3. </span>Méthodes update/upsert<a class="headerlink" href="#methodes-update-upsert" title="Permalink to this headline">¶</a></h3>
<p>Pour modifier des enregistrements existants, utilisez l’opérateur <code class="docutils literal notranslate"><span class="pre">update()</span></code> :</p>
<p><strong>Modification d’un document :</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">find</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 2</caption>
<thead>
	<tr><th></th><th scope=col>prenom</th><th scope=col>age</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>yolan </td><td>NA</td></tr>
	<tr><th scope=row>2</th><td>paul  </td><td>22</td></tr>
	<tr><th scope=row>3</th><td>faisal</td><td>NA</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">update</span><span class="p">(</span><span class="s">&#39;{&quot;prenom&quot;:&quot;yolan&quot;}&#39;</span><span class="p">,</span> <span class="s">&#39;{&quot;$set&quot;:{&quot;age&quot;: 22}}&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>List of 3
 $ modifiedCount: int 1
 $ matchedCount : int 1
 $ upsertedCount: int 0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">find</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 2</caption>
<thead>
	<tr><th></th><th scope=col>prenom</th><th scope=col>age</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>yolan </td><td>22</td></tr>
	<tr><th scope=row>2</th><td>paul  </td><td>22</td></tr>
	<tr><th scope=row>3</th><td>faisal</td><td>NA</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Nous pouvons noter l’équivalent en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="8e74c5fb-0df3-4cd7-8acd-4a4f7250885b" name="f094764f-53ef-4a3a-8928-58dc637ae21d" type="radio">
</input><label class="tabbed-label" for="8e74c5fb-0df3-4cd7-8acd-4a4f7250885b">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">update</span><span class="p">(</span><span class="s">&#39;{&quot;prenom&quot;:&quot;yolan&quot;}&#39;</span><span class="p">,</span> <span class="s">&#39;{&quot;$set&quot;:{&quot;age&quot;: 22}}&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="01c91e78-65aa-401d-823b-d5d466d55cba" name="f094764f-53ef-4a3a-8928-58dc637ae21d" type="radio">
</input><label class="tabbed-label" for="01c91e78-65aa-401d-823b-d5d466d55cba">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">individus</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
<span class="p">{</span><span class="s2">&quot;prenom&quot;</span> <span class="o">:</span> <span class="s2">&quot;yolan&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="nx">$set</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span> <span class="o">:</span> <span class="mf">22</span><span class="p">}}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Mise à jour de plusieurs documents :</strong></p>
<p>Par défaut, la méthode <code class="docutils literal notranslate"><span class="pre">update()</span></code> met à jour un seul document. Pour mettre à jour plusieurs documents, utilisez l’option <code class="docutils literal notranslate"><span class="pre">multi</span></code> de la méthode <code class="docutils literal notranslate"><span class="pre">update()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">update</span><span class="p">(</span><span class="s">&#39;{}&#39;</span><span class="p">,</span> <span class="s">&#39;{&quot;$set&quot;:{&quot;booleen_age&quot;: false}}&#39;</span><span class="p">,</span> <span class="n">multiple</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>List of 3
 $ modifiedCount: int 3
 $ matchedCount : int 3
 $ upsertedCount: int 0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">update</span><span class="p">(</span><span class="s">&#39;{&quot;age&quot; : {&quot;$gte&quot; : 0}}&#39;</span><span class="p">,</span> <span class="s">&#39;{&quot;$set&quot;:{&quot;booleen_age&quot;: true}}&#39;</span><span class="p">,</span> <span class="n">multiple</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>List of 3
 $ modifiedCount: int 2
 $ matchedCount : int 2
 $ upsertedCount: int 0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">find</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 3</caption>
<thead>
	<tr><th></th><th scope=col>prenom</th><th scope=col>age</th><th scope=col>booleen_age</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;lgl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>yolan </td><td>22</td><td> TRUE</td></tr>
	<tr><th scope=row>2</th><td>paul  </td><td>22</td><td> TRUE</td></tr>
	<tr><th scope=row>3</th><td>faisal</td><td>NA</td><td>FALSE</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Nous pouvons également noter l’équivalent en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="798d2a58-a8f8-45d0-bea8-dabc7a0ecd61" name="4f8772ca-1551-4b88-afaa-d7022967933c" type="radio">
</input><label class="tabbed-label" for="798d2a58-a8f8-45d0-bea8-dabc7a0ecd61">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">update</span><span class="p">(</span><span class="s">&#39;{}&#39;</span><span class="p">,</span> <span class="s">&#39;{&quot;$set&quot;:{&quot;booleen_age&quot;: false}}&#39;</span><span class="p">,</span> <span class="n">multiple</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="n">individus</span><span class="o">$</span><span class="nf">update</span><span class="p">(</span><span class="s">&#39;{&quot;age&quot; : {&quot;$gte&quot; : 0}}&#39;</span><span class="p">,</span> <span class="s">&#39;{&quot;$set&quot;:{&quot;booleen_age&quot;: true}}&#39;</span><span class="p">,</span> <span class="n">multiple</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="82f02bd6-d259-431f-b882-00b740fcc743" name="4f8772ca-1551-4b88-afaa-d7022967933c" type="radio">
</input><label class="tabbed-label" for="82f02bd6-d259-431f-b882-00b740fcc743">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">individus</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
<span class="p">{},</span>
<span class="p">{</span><span class="nx">$set</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;booleen_age&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">}},</span>
<span class="p">{</span><span class="nx">multi</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
<span class="p">)</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">individus</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
<span class="p">{</span><span class="s2">&quot;age&quot;</span> <span class="o">:</span> <span class="p">{</span><span class="s2">&quot;$gte&quot;</span> <span class="o">:</span> <span class="mf">0</span><span class="p">}},</span>
<span class="p">{</span><span class="nx">$set</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;booleen_age&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">}},</span>
<span class="p">{</span><span class="nx">multi</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Modification avec création d’un document si besoin :</strong></p>
<p>Si aucun document ne correspond à la condition de mise à jour, le comportement par défaut de la méthode de mise à jour est de ne rien faire. En spécifiant l’option <code class="docutils literal notranslate"><span class="pre">upsert</span></code> à <code class="docutils literal notranslate"><span class="pre">true</span></code>, l’opération de mise à jour met à jour le ou les documents correspondants ou insère un nouveau document si aucun document correspondant n’existe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">update</span><span class="p">(</span><span class="s">&#39;{&quot;prenom&quot;:&quot;malo&quot;}&#39;</span><span class="p">,</span> <span class="s">&#39;{&quot;$set&quot;:{&quot;age&quot;: 22}}&#39;</span><span class="p">,</span> <span class="n">upsert</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>List of 4
 $ modifiedCount: int 0
 $ matchedCount : int 0
 $ upsertedCount: int 1
 $ upsertedId   : chr &quot;608a72cf43f60737b0e7c7e2&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">find</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 4 × 3</caption>
<thead>
	<tr><th></th><th scope=col>prenom</th><th scope=col>age</th><th scope=col>booleen_age</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;lgl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>yolan </td><td>22</td><td> TRUE</td></tr>
	<tr><th scope=row>2</th><td>paul  </td><td>22</td><td> TRUE</td></tr>
	<tr><th scope=row>3</th><td>faisal</td><td>NA</td><td>FALSE</td></tr>
	<tr><th scope=row>4</th><td>malo  </td><td>22</td><td>   NA</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Nous pouvons également noter l’équivalent en MongoDB :</p>
<div class="tabbed-set docutils">
<input checked="checked" id="dd7a751f-f7f1-4f0c-a8c1-ea60d6fcf7ff" name="c6a4d7fb-bcf2-4204-b9c3-99e9b7228117" type="radio">
</input><label class="tabbed-label" for="dd7a751f-f7f1-4f0c-a8c1-ea60d6fcf7ff">
Mongolite</label><div class="tabbed-content docutils">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">update</span><span class="p">(</span><span class="s">&#39;{&quot;prenom&quot;:&quot;malo&quot;}&#39;</span><span class="p">,</span> <span class="s">&#39;{&quot;$set&quot;:{&quot;age&quot;: 22}}&#39;</span><span class="p">,</span> <span class="n">upsert</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="8eb10d95-c216-4926-b7cb-bb60a6410984" name="c6a4d7fb-bcf2-4204-b9c3-99e9b7228117" type="radio">
</input><label class="tabbed-label" for="8eb10d95-c216-4926-b7cb-bb60a6410984">
Équivalent MongoDB</label><div class="tabbed-content docutils">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">individus</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
<span class="p">{</span><span class="s2">&quot;prenom&quot;</span><span class="o">:</span><span class="s2">&quot;malo&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="nx">$set</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="mf">22</span><span class="p">}},</span>
<span class="p">{</span><span class="nx">upsert</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="import-et-export-de-donnees">
<h2><span class="section-number">7.2.5. </span>Import et export de données<a class="headerlink" href="#import-et-export-de-donnees" title="Permalink to this headline">¶</a></h2>
<div class="section" id="la-methode-export-import-pour-json">
<h3><span class="section-number">7.2.5.1. </span>La méthode export/import pour JSON<a class="headerlink" href="#la-methode-export-import-pour-json" title="Permalink to this headline">¶</a></h3>
<p>Le format par défaut JSON est celui d’une ligne par document.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">export</span><span class="p">(</span><span class="nf">stdout</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;608a72ce9ab7a318946cb8f9&quot; }, &quot;prenom&quot; : &quot;yolan&quot;, &quot;age&quot; : 22, &quot;booleen_age&quot; : true }
{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;608a72ce9ab7a318946cb8fa&quot; }, &quot;prenom&quot; : &quot;paul&quot;, &quot;age&quot; : 22, &quot;booleen_age&quot; : true }
{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;608a72ce9ab7a318946cb8fb&quot; }, &quot;prenom&quot; : &quot;faisal&quot;, &quot;booleen_age&quot; : false }
{ &quot;_id&quot; : { &quot;$oid&quot; : &quot;608a72cf43f60737b0e7c7e2&quot; }, &quot;prenom&quot; : &quot;malo&quot;, &quot;age&quot; : 22 }
</pre></div>
</div>
</div>
</div>
<p>En temps normal on exporte vers un fichier que l’on précise avec <code class="docutils literal notranslate"><span class="pre">file()</span></code> :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">export</span><span class="p">(</span><span class="nf">file</span><span class="p">(</span><span class="s">&quot;individus.json&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>On peut faire l’essai de supprimer totalement la collection et de l’importer ensuite :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">drop</span><span class="p">()</span>
<span class="n">individus</span><span class="o">$</span><span class="nf">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">individus</span><span class="o">$</span><span class="nf">import</span><span class="p">(</span><span class="nf">file</span><span class="p">(</span><span class="s">&quot;individus.json&quot;</span><span class="p">))</span>
<span class="n">individus</span><span class="o">$</span><span class="nf">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">4</div></div>
</div>
</div>
<div class="section" id="autres-formats-d-export-jsonlite-bjson">
<h3><span class="section-number">7.2.5.2. </span>Autres formats d’export (jsonlite/bjson/…)<a class="headerlink" href="#autres-formats-d-export-jsonlite-bjson" title="Permalink to this headline">¶</a></h3>
<p>Pour ces autres formats ou package concernant les méthodes <code class="docutils literal notranslate"><span class="pre">import()</span></code> et <code class="docutils literal notranslate"><span class="pre">export()</span></code>, nous vous renvoyons <a class="reference external" href="https://jeroen.github.io/mongolite/import-export.html">à la page de Jeroen Ooms</a>.</p>
</div>
</div>
<div class="section" id="exercices">
<h2><span class="section-number">7.2.6. </span>Exercices<a class="headerlink" href="#exercices" title="Permalink to this headline">¶</a></h2>
<div class="section" id="consignes">
<h3><span class="section-number">7.2.6.1. </span>Consignes<a class="headerlink" href="#consignes" title="Permalink to this headline">¶</a></h3>
<p><strong>Exercice 1 :</strong></p>
<ol class="simple">
<li><p>A l’aide d’une requête d’aggrégation, récupérer le nombre de restaurants par quatier dans la collection NYfood.</p></li>
<li><p>Réaliser un barplot pour visualiser le résultat.</p></li>
</ol>
<p><strong>Exercice 2 :</strong></p>
<p>Cet exercice reprend l’exemple de carthographie avec leaflet de François-Xavier Jollois, disponible <a class="reference external" href="https://fxjollois.github.io/cours-2017-2018/du-abd-r/connexion-r-mongodb.html#un_peu_de_cartographie_avec_leaflet">en cliquant ici.</a></p>
<ol class="simple">
<li><p>A l’aide d’une requête d’aggrégation, récupérer le nom, le quartier, la longitude et la latitude des restaurant new-yorkais de la collection NYfood.</p></li>
<li><p>Afficher les différents restaurants sur la carte du monde. Que constatez vous ?</p></li>
<li><p>Réaliser une carte des restaurants new-yorkais en ajoutant une couleur en fonction du quartier (coordonnées de New-York : long: -73.9, lat  =  40.7).</p></li>
</ol>
</div>
<div class="section" id="correction">
<h3><span class="section-number">7.2.6.2. </span>Correction<a class="headerlink" href="#correction" title="Permalink to this headline">¶</a></h3>
<p><strong>Exercice 1 :</strong></p>
<p><strong>Question 1 :</strong></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">req</span> <span class="o">=</span> <span class="s">&#39;[{&quot;$group&quot;:{&quot;_id&quot;:&quot;$borough&quot;,&quot;nb_restos&quot;:{&quot;$sum&quot;:1}}}]&#39;</span> 
<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">coll</span><span class="o">$</span><span class="nf">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="o">=</span><span class="n">req</span><span class="p">)</span> 
<span class="n">df</span>
</pre></div>
</div>
<p><strong>Question 2 :</strong></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>

<span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">rename</span><span class="p">(</span><span class="n">Borough</span><span class="o">=</span><span class="n">`_id`</span><span class="p">,</span><span class="n">Nombre</span><span class="o">=</span><span class="n">nb_restos</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Borough</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Nombre</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">Borough</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">Nombre</span><span class="p">),</span> <span class="n">vjust</span><span class="o">=</span><span class="m">1.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="m">3.5</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Exercice 2 :</strong></p>
<p><strong>Question 1 :</strong></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">restos.coord</span> <span class="o">=</span> <span class="n">coll</span><span class="o">$</span><span class="nf">aggregate</span><span class="p">(</span>
  <span class="s">&#39;[</span>
<span class="s">    { &quot;$project&quot;: { </span>
<span class="s">        &quot;name&quot;: 1, </span>
<span class="s">        &quot;borough&quot;: 1, </span>
<span class="s">        &quot;lng&quot;: { &quot;$arrayElemAt&quot;: [&quot;$address.loc.coordinates&quot;, 0]}, </span>
<span class="s">        &quot;lat&quot;: { &quot;$arrayElemAt&quot;: [&quot;$address.loc.coordinates&quot;, 1]} </span>
<span class="s">    }}</span>
<span class="s">]&#39;</span><span class="p">)</span>

<span class="nf">head</span><span class="p">(</span><span class="n">restos.coord</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Question 2 :</strong></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">leaflet</span><span class="p">)</span>

<span class="nf">leaflet</span><span class="p">(</span><span class="n">restos.coord</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">addTiles</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">addCircles</span><span class="p">(</span><span class="n">lng</span> <span class="o">=</span> <span class="o">~</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="o">~</span><span class="n">lat</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Question 3 :</strong></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">pal</span> <span class="o">=</span> <span class="nf">colorFactor</span><span class="p">(</span><span class="s">&quot;Accent&quot;</span><span class="p">,</span> <span class="n">restos.coord</span><span class="o">$</span><span class="n">borough</span><span class="p">)</span>
<span class="nf">leaflet</span><span class="p">(</span><span class="n">restos.coord</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">addProviderTiles</span><span class="p">(</span><span class="n">providers</span><span class="o">$</span><span class="n">CartoDB.Positron</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">setView</span><span class="p">(</span><span class="n">lng</span>  <span class="o">=</span> <span class="m">-73.9</span><span class="p">,</span>
          <span class="n">lat</span>  <span class="o">=</span>  <span class="m">40.7</span><span class="p">,</span>
          <span class="n">zoom</span> <span class="o">=</span>  <span class="m">10</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">addCircles</span><span class="p">(</span><span class="n">lng</span> <span class="o">=</span> <span class="o">~</span><span class="n">lng</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="o">~</span><span class="n">lat</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="o">~</span><span class="nf">pal</span><span class="p">(</span><span class="n">borough</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">addLegend</span><span class="p">(</span><span class="n">pal</span> <span class="o">=</span> <span class="n">pal</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="o">~</span><span class="n">borough</span><span class="p">,</span> <span class="n">opacity</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> 
            <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Quartier&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="07_scripts_py.html" title="previous page"><span class="section-number">7.1. </span>Requêtes depuis Python : <code class="docutils literal notranslate"><span class="pre">pymongo</span></code></a>
    <a class='right-next' id="next-link" href="app_exemple.html" title="next page">Annexe A : Exemple de fichier source</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Ouvrage collectif<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>