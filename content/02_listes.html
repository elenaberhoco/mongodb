
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2. Attributs de type liste &#8212; MongoDB : notes de cours</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Attributs de type date" href="03_dates.html" />
    <link rel="prev" title="1. Premières requêtes en MongoDB" href="01_find.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">MongoDB : notes de cours</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="00_intro.html">
   MongoDB : Notes de cours
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapitres
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_find.html">
   1. Premières requêtes en MongoDB
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2. Attributs de type liste
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_dates.html">
   3. Attributs de type date
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_index.html">
   4. Les index
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_agreg.html">
   5. Les requêtes d’agrégation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_modif.html">
   6. Les requêtes de modification
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="07_scripts.html">
   7. Effectuer des requêtes depuis des programmes Python ou R
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="07_scripts_py.html">
     7.1. Requêtes depuis Python :
     <code class="docutils literal notranslate">
      <span class="pre">
       pymongo
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07_scripts_R.html">
     7.2. Requêtes depuis R :
     <code class="docutils literal notranslate">
      <span class="pre">
       mongolite
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/content/02_listes.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/content/02_listes.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/rtavenar/mongo_book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/rtavenar/mongo_book/issues/new?title=Issue%20on%20page%20%2Fcontent/02_listes.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/rtavenar/mongo_book/main?urlpath=tree/docs/content/02_listes.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   2.1. Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fonctionnement-des-listes-en-mongodb">
   2.2. Fonctionnement des listes en MongoDB
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#operateur-size">
     2.2.1. Opérateur $size
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#particularite-du-travail-sur-des-listes">
   2.3. Particularité du travail sur des listes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#au-moins-un-element-ou-tous-les-elements">
     2.3.1. “au moins un élément” ou “tous les éléments” ?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cas-des-conditions-multiples">
     2.3.2. Cas des conditions multiples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#operateur-elemmatch">
     2.3.3. Opérateur
     <code class="docutils literal notranslate">
      <span class="pre">
       $elemMatch
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cas-de-conditions-simultanement-non-realisables">
       2.3.3.1. Cas de conditions simultanement non réalisables
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cas-de-conditions-simultanement-realisables">
       2.3.3.2. Cas de conditions simultanement réalisables
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recapitulatif">
   2.4. Récapitulatif
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Attributs de type liste</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   2.1. Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fonctionnement-des-listes-en-mongodb">
   2.2. Fonctionnement des listes en MongoDB
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#operateur-size">
     2.2.1. Opérateur $size
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#particularite-du-travail-sur-des-listes">
   2.3. Particularité du travail sur des listes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#au-moins-un-element-ou-tous-les-elements">
     2.3.1. “au moins un élément” ou “tous les éléments” ?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cas-des-conditions-multiples">
     2.3.2. Cas des conditions multiples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#operateur-elemmatch">
     2.3.3. Opérateur
     <code class="docutils literal notranslate">
      <span class="pre">
       $elemMatch
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cas-de-conditions-simultanement-non-realisables">
       2.3.3.1. Cas de conditions simultanement non réalisables
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cas-de-conditions-simultanement-realisables">
       2.3.3.2. Cas de conditions simultanement réalisables
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recapitulatif">
   2.4. Récapitulatif
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="attributs-de-type-liste">
<h1><span class="section-number">2. </span>Attributs de type liste<a class="headerlink" href="#attributs-de-type-liste" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Auteurs/trices : <strong>Malo REYNES, Lucas ROBIN, Fiona TUFFIN</strong></p></li>
</ul>
<p>Ce chapitre traite des attributs de type liste et des différents types de requêtes que l’on peut vouloir faire sur de tels attributs</p>
<div class="section" id="introduction">
<h2><span class="section-number">2.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>En MongoDB, un document est composé de couples clé/valeur. Une clé peut être considérée comme le nom d’une variable (attribut) à laquelle correspond une valeur pour un individu. L’attribut peut être de plusieurs types : chaîne de caractères, booléen, nombre, liste ou date. C’est aux attributs de type <em>liste</em> que nous nous intéressons ici. En MongoDB comme en python, une liste est, comme son nom l’indique, une série de valeurs, ces valeurs pouvant être de tous types. Une liste peut également contenir des sous-listes. Il est possible de réaliser plusieurs opérations sur une liste telles qu’obtenir sa taille, récupérer son minimum, son maximum, sa moyenne et autres. Il faut toutefois faire attention à certains “pièges” que nous exposerons.</p>
<p>Les exemples pour cette partie concernent les listes de notes des élèves de la collection <code class="docutils literal notranslate"><span class="pre">notes</span></code> de la base de données <code class="docutils literal notranslate"><span class="pre">etudiants</span></code>. On notera aussi que certains types de requêtes comme les <code class="docutils literal notranslate"><span class="pre">sum()</span></code> ou les <code class="docutils literal notranslate"><span class="pre">avg()</span></code> nécessitent des requêtes d’agrégation qui seront évoquées dans un chapitre suivant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">etudiants</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>switched to db etudiants
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fonctionnement-des-listes-en-mongodb">
<h2><span class="section-number">2.2. </span>Fonctionnement des listes en MongoDB<a class="headerlink" href="#fonctionnement-des-listes-en-mongodb" title="Permalink to this headline">¶</a></h2>
<p>Afin de mieux appréhender les listes en MongoDB, nous allons suivre un exemple au cours du quel, étape par étape, nous expliquerons notre démarche. Nous souhaitons connaître les étudiants ayant toutes leurs notes supérieures ou égales à 12.</p>
<blockquote>
<div><p>Remarque : les notes sont implémentées sous forme de liste dans la base de données (attribut <code class="docutils literal notranslate"><span class="pre">notes</span></code>). Parmi les 7 étudiants, un ne possède pas d’attribut <code class="docutils literal notranslate"><span class="pre">notes</span></code> et un autre à ce même attribut vide (liste contenant 0 élément). Nous allons donc traiter ces cas particuliers.</p>
</div></blockquote>
<div class="section" id="operateur-size">
<h3><span class="section-number">2.2.1. </span>Opérateur $size<a class="headerlink" href="#operateur-size" title="Permalink to this headline">¶</a></h3>
<p>Introduisons tout d’abord un élément utile pour comprendre le fonctionnement des listes : l’opérateur <code class="docutils literal notranslate"><span class="pre">$size</span></code>. Il renvoie les documents dont la taille (nombre d’éléments de la liste) vérifie la condition donnée.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$size</span><span class="o">:</span> <span class="mf">2</span><span class="p">}}</span>                     <span class="cm">/*Listes de 2 éléments*/</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773d&quot;),
	&quot;nom&quot; : &quot;Paul&quot;,
	&quot;notes&quot; : [
		10,
		12
	],
	&quot;sexe&quot; : &quot;M&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d7741&quot;),
	&quot;nom&quot; : &quot;Marc&quot;,
	&quot;notes&quot; : [
		1,
		5
	],
	&quot;ddn&quot; : ISODate(&quot;1993-01-01T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
</pre></div>
</div>
</div>
</div>
<p>Attention, cet opérateur n’est pas compatible avec les intervalles de valeurs. On ne peut pas écrire le code suivant (qui renvoie une erreur) :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$size</span><span class="o">:</span> <span class="p">{</span><span class="nx">$lte</span><span class="o">:</span> <span class="mf">2</span><span class="p">}}}</span>             <span class="cm">/*Ne fonctionne pas, la taille doit être une valeur précise !!!*/</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error: error: {
	&quot;ok&quot; : 0,
	&quot;errmsg&quot; : &quot;$size needs a number&quot;,
	&quot;code&quot; : 2,
	&quot;codeName&quot; : &quot;BadValue&quot;
}
</pre></div>
</div>
</div>
</div>
<p>Il faudra plutôt écrire :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="nx">$or</span> <span class="o">:</span> 
        <span class="p">[{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$size</span><span class="o">:</span> <span class="mf">2</span><span class="p">}},</span>
        <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$size</span><span class="o">:</span> <span class="mf">1</span><span class="p">}},</span>
        <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$size</span><span class="o">:</span> <span class="mf">0</span><span class="p">}}]</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773d&quot;),
	&quot;nom&quot; : &quot;Paul&quot;,
	&quot;notes&quot; : [
		10,
		12
	],
	&quot;sexe&quot; : &quot;M&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773f&quot;),
	&quot;nom&quot; : &quot;Hélène&quot;,
	&quot;notes&quot; : [
		13
	],
	&quot;ddn&quot; : ISODate(&quot;1995-03-05T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;F&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d7741&quot;),
	&quot;nom&quot; : &quot;Marc&quot;,
	&quot;notes&quot; : [
		1,
		5
	],
	&quot;ddn&quot; : ISODate(&quot;1993-01-01T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d7740&quot;),
	&quot;nom&quot; : &quot;Sophie&quot;,
	&quot;notes&quot; : [ ],
	&quot;ddn&quot; : ISODate(&quot;1996-09-12T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;F&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d7742&quot;),
	&quot;nom&quot; : &quot;Marc&quot;,
	&quot;notes&quot; : [
		15
	],
	&quot;ddn&quot; : ISODate(&quot;1993-03-06T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
</pre></div>
</div>
</div>
</div>
<p>Exemple : on veut connaitre les notes de l’étudiant nommé Paul.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;nom&quot;</span><span class="o">:</span> <span class="s2">&quot;Paul&quot;</span><span class="p">},</span> 
    <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{ &quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773d&quot;), &quot;notes&quot; : [ 10, 12 ] }
</pre></div>
</div>
</div>
</div>
<p>Une liste de 2 notes est retournée. Plus précisement, c’est le contenu de l’attribut <code class="docutils literal notranslate"><span class="pre">notes</span></code> qui est donné.</p>
</div>
</div>
<div class="section" id="particularite-du-travail-sur-des-listes">
<h2><span class="section-number">2.3. </span>Particularité du travail sur des listes<a class="headerlink" href="#particularite-du-travail-sur-des-listes" title="Permalink to this headline">¶</a></h2>
<p>Les listes sont des objets particuliers pour lesquels des questions particulières se posent.
Nous nous penchons ici sur deux de ces questions spécifiques aux listes.</p>
<div class="section" id="au-moins-un-element-ou-tous-les-elements">
<h3><span class="section-number">2.3.1. </span>“au moins un élément” ou “tous les éléments” ?<a class="headerlink" href="#au-moins-un-element-ou-tous-les-elements" title="Permalink to this headline">¶</a></h3>
<p>Exemple : on veut savoir si l’étudiant Paul a eu au moins une note égale à 12. Pour ce faire, on ajoute une condition sur les notes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;nom&quot;</span><span class="o">:</span> <span class="s2">&quot;Paul&quot;</span><span class="p">,</span> <span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="mf">12</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773d&quot;),
	&quot;nom&quot; : &quot;Paul&quot;,
	&quot;notes&quot; : [
		10,
		12
	],
	&quot;sexe&quot; : &quot;M&quot;
}
</pre></div>
</div>
</div>
</div>
<p>La requête ressort un seul document : celui correspondant à l’étudiant Paul de notre collection. Cela signifie donc que Paul a eu au moins une note égale à 12.
Néanmoins, l’objet retourné par la requête est l’ensemble du document. Toutes les notes de Paul sont données, même celles différentes de 12.</p>
<p>Voyons maintenant ce qui se passe lorsqu’on recherche les notes supérieures ou égales à 12.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$gte</span><span class="o">:</span> <span class="mf">12</span><span class="p">}}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773d&quot;),
	&quot;nom&quot; : &quot;Paul&quot;,
	&quot;notes&quot; : [
		10,
		12
	],
	&quot;sexe&quot; : &quot;M&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773f&quot;),
	&quot;nom&quot; : &quot;Hélène&quot;,
	&quot;notes&quot; : [
		13
	],
	&quot;ddn&quot; : ISODate(&quot;1995-03-05T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;F&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773c&quot;),
	&quot;nom&quot; : &quot;Jean&quot;,
	&quot;notes&quot; : [
		1,
		5,
		7,
		10,
		12,
		14,
		3
	],
	&quot;ddn&quot; : ISODate(&quot;1995-05-25T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d7742&quot;),
	&quot;nom&quot; : &quot;Marc&quot;,
	&quot;notes&quot; : [
		15
	],
	&quot;ddn&quot; : ISODate(&quot;1993-03-06T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
</pre></div>
</div>
</div>
</div>
<p>Avec cette requête, nous obtenons 4 éléments correspondant aux 4 étudiants qui ont eu au moins une note supérieure ou égale à 12.</p>
<p>Nous voudrions maintenant ressortir les individus qui n’ont <strong>que</strong> des notes supérieures ou égales à 12. Pour cela, nous pouvons retirer tous les étudiants ayant eu des notes en dessous de 12. Pour ce faire, nous utilisons l’opérateur logique <code class="docutils literal notranslate"><span class="pre">$not</span></code> qui retire les documents ne réalisant pas la condition demandée.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">$not</span><span class="o">:</span> <span class="p">{</span><span class="nx">$lt</span><span class="o">:</span> <span class="mf">12</span><span class="p">}}}</span>              <span class="cm">/*Une condition : on enlève les étudiants qui ont au moins une note plus petite que 12*/</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773e&quot;),
	&quot;nom&quot; : &quot;Michel&quot;,
	&quot;ddn&quot; : ISODate(&quot;1995-02-13T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773f&quot;),
	&quot;nom&quot; : &quot;Hélène&quot;,
	&quot;notes&quot; : [
		13
	],
	&quot;ddn&quot; : ISODate(&quot;1995-03-05T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;F&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d7740&quot;),
	&quot;nom&quot; : &quot;Sophie&quot;,
	&quot;notes&quot; : [ ],
	&quot;ddn&quot; : ISODate(&quot;1996-09-12T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;F&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d7742&quot;),
	&quot;nom&quot; : &quot;Marc&quot;,
	&quot;notes&quot; : [
		15
	],
	&quot;ddn&quot; : ISODate(&quot;1993-03-06T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
</pre></div>
</div>
</div>
</div>
<p>Problème : la requête nous renvoie également les étudiants qui n’ont pas eu de note. C’est logique : si Sophie n’a pas de note, on ne peut pas dire qu’elle ait déjà eu moins que 12. Nous allons donc retirer les étudiants sans notes.</p>
<p>Pour se faire, nous utilisons l’opérateur logique <code class="docutils literal notranslate"><span class="pre">$nor</span></code> en listant les éléments à ne pas prendre en compte. Nous ne voulons pas que la liste <code class="docutils literal notranslate"><span class="pre">notes</span></code> soit vide ou qu’elle comporte ne serait-ce qu’une note inférieure à 12.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="nx">$nor</span><span class="o">:</span> 
        <span class="p">[{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$lt</span><span class="o">:</span> <span class="mf">12</span><span class="p">}},</span>               <span class="cm">/*1ère condition : on retire ceux qui ont des notes en dessous de 12*/</span>
        <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$size</span><span class="o">:</span> <span class="mf">0</span><span class="p">}}]</span>               <span class="cm">/*2nde condition : on retire ceux qui n&#39;ont pas de notes*/</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773e&quot;),
	&quot;nom&quot; : &quot;Michel&quot;,
	&quot;ddn&quot; : ISODate(&quot;1995-02-13T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773f&quot;),
	&quot;nom&quot; : &quot;Hélène&quot;,
	&quot;notes&quot; : [
		13
	],
	&quot;ddn&quot; : ISODate(&quot;1995-03-05T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;F&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d7742&quot;),
	&quot;nom&quot; : &quot;Marc&quot;,
	&quot;notes&quot; : [
		15
	],
	&quot;ddn&quot; : ISODate(&quot;1993-03-06T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
</pre></div>
</div>
</div>
</div>
<p>Nouveau problème : le document correspondant à l’étudiant Michel est renvoyé parce qu’il n’a pas d’attribut <code class="docutils literal notranslate"><span class="pre">notes</span></code>. Dans ces conditions, on remarque que les listes vides ou inexistantes sont retournées par les requêtes. Il est important de les enlever en rajoutant une condition dans le <code class="docutils literal notranslate"><span class="pre">$nor</span></code>.</p>
<p>Il faut donc retirer les étudiants qui ont une liste <code class="docutils literal notranslate"><span class="pre">notes</span></code> vide mais aussi ceux qui n’ont pas de liste du tout.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="nx">$nor</span><span class="o">:</span> 
        <span class="p">[{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$exists</span><span class="o">:</span> <span class="kc">false</span><span class="p">}},</span>         <span class="cm">/*1ère condition : on retire les documents ne possédant pas de liste &quot;notes&quot;*/</span>
        <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$lt</span><span class="o">:</span> <span class="mf">12</span><span class="p">}},</span>                 <span class="cm">/*2ème condition : on retire ceux qui ont des notes en dessous de 12*/</span>
        <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$size</span><span class="o">:</span> <span class="mf">0</span><span class="p">}}]</span>                <span class="cm">/*3ème condition : on retire ceux qui n&#39;ont pas de notes*/</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773f&quot;),
	&quot;nom&quot; : &quot;Hélène&quot;,
	&quot;notes&quot; : [
		13
	],
	&quot;ddn&quot; : ISODate(&quot;1995-03-05T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;F&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d7742&quot;),
	&quot;nom&quot; : &quot;Marc&quot;,
	&quot;notes&quot; : [
		15
	],
	&quot;ddn&quot; : ISODate(&quot;1993-03-06T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
</pre></div>
</div>
</div>
</div>
<p>Cette fois, on ne retourne plus que 2 étudiants qui n’ont que des notes au-dessus de 12.</p>
</div>
<div class="section" id="cas-des-conditions-multiples">
<h3><span class="section-number">2.3.2. </span>Cas des conditions multiples<a class="headerlink" href="#cas-des-conditions-multiples" title="Permalink to this headline">¶</a></h3>
<p>Lorsque nous faisons des requêtes sur un attribut d’un autre type qu’une liste, un seul élement est soumis à l’ensemble de nos conditions.
Dans l’exemple ci-dessous, la clé <code class="docutils literal notranslate"><span class="pre">nom</span></code> renvoie une chaine de caractères, qui est un élément unique. Cet élément est soumis à deux conditions afin d’obtenir les noms qui commencent par la lettre M.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>                                <span class="cm">/*Cette requête nous renvoie les noms dont la première lettre est comprise &gt;= à M et &lt; à N, donc M*/</span>
    <span class="p">{</span><span class="s2">&quot;nom&quot;</span><span class="o">:</span> 
        <span class="p">{</span><span class="nx">$gte</span><span class="o">:</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="nx">$lt</span><span class="o">:</span> <span class="s2">&quot;N&quot;</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773e&quot;),
	&quot;nom&quot; : &quot;Michel&quot;,
	&quot;ddn&quot; : ISODate(&quot;1995-02-13T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d7741&quot;),
	&quot;nom&quot; : &quot;Marc&quot;,
	&quot;notes&quot; : [
		1,
		5
	],
	&quot;ddn&quot; : ISODate(&quot;1993-01-01T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d7742&quot;),
	&quot;nom&quot; : &quot;Marc&quot;,
	&quot;notes&quot; : [
		15
	],
	&quot;ddn&quot; : ISODate(&quot;1993-03-06T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
</pre></div>
</div>
</div>
</div>
<p>Avec les listes, c’est différent. Chaque élément contenu dans la liste est testé par les conditions. Voyons le fonctionnement d’une requête sur une liste avec plusieurs conditions :</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> 
        <span class="p">{</span><span class="nx">$gt</span><span class="o">:</span> <span class="mf">13</span><span class="p">,</span> <span class="nx">$lte</span><span class="o">:</span> <span class="mf">10</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773c&quot;),
	&quot;nom&quot; : &quot;Jean&quot;,
	&quot;notes&quot; : [
		1,
		5,
		7,
		10,
		12,
		14,
		3
	],
	&quot;ddn&quot; : ISODate(&quot;1995-05-25T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
</pre></div>
</div>
</div>
</div>
<p>Cette requête teste pour chaque élément de la liste un à un :</p>
<ul class="simple">
<li><p>La condition <span class="math notranslate nohighlight">\(&gt; 13\)</span>;</p></li>
<li><p>La condition <span class="math notranslate nohighlight">\(\le 10\)</span>;</p></li>
</ul>
<p>Si chacune des conditions est vérifiée au moins une fois, la liste complète est renvoyée. En clair, si au moins un élément de la liste est <span class="math notranslate nohighlight">\(&gt; 13\)</span> et au moins un élément est <span class="math notranslate nohighlight">\(\le 10\)</span>, les conditions sont considérées comme validées.</p>
<p>Ainsi, à la liste “[1,5,7,10,12,14,3]” correspond :</p>
<ul class="simple">
<li><p>[F,F,F,F,F,T,F] pour la première condition</p></li>
<li><p>[T,T,T,T,F,F,T] pour la seconde
Les conditions sont toutes respectées au moins une fois, la liste complète est donc renvoyée.</p></li>
</ul>
<p>Ainsi, nous ne testons pas simultanément les deux conditions sur chaque nombre. Aucun nombre x ne vérifie x <span class="math notranslate nohighlight">\(&gt; 13\)</span> et x <span class="math notranslate nohighlight">\(\le 10\)</span>. Cela est contre-intuitif, il faut faire attention.</p>
<p>Mais alors, comment pouvons-nous justement tester une double condition sur chaque élement de la liste ? Pour cela, nous allons faire appel à l’opérateur <code class="docutils literal notranslate"><span class="pre">$elemMatch</span></code>.</p>
</div>
<div class="section" id="operateur-elemmatch">
<h3><span class="section-number">2.3.3. </span>Opérateur <code class="docutils literal notranslate"><span class="pre">$elemMatch</span></code><a class="headerlink" href="#operateur-elemmatch" title="Permalink to this headline">¶</a></h3>
<p>Avec <code class="docutils literal notranslate"><span class="pre">$elemMatch</span></code>, on retourne les documents dont au moins un élément de la liste vérifie toutes les conditions.</p>
<div class="section" id="cas-de-conditions-simultanement-non-realisables">
<h4><span class="section-number">2.3.3.1. </span>Cas de conditions simultanement non réalisables<a class="headerlink" href="#cas-de-conditions-simultanement-non-realisables" title="Permalink to this headline">¶</a></h4>
<p>Testez votre intuition ! D’après vous, que ressortira cette requête ?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> 
        <span class="p">{</span><span class="nx">$elemMatch</span><span class="o">:</span> 
            <span class="p">{</span><span class="nx">$gt</span><span class="o">:</span> <span class="mf">13</span><span class="p">,</span> <span class="nx">$lte</span><span class="o">:</span> <span class="mf">10</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Contrairement à la requête précedente, cette requête teste les élements de la liste un à un. Ainsi, aucun élement ne vérifie ces deux conditions simultanement. Aucun élément n’est donc retourné par cette requête.</p>
</div>
<div class="section" id="cas-de-conditions-simultanement-realisables">
<h4><span class="section-number">2.3.3.2. </span>Cas de conditions simultanement réalisables<a class="headerlink" href="#cas-de-conditions-simultanement-realisables" title="Permalink to this headline">¶</a></h4>
<p>Avec la requête suivante, nous cherchons à savoir quels étudiants ont au moins une note comprise entre 9 et 13.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> 
        <span class="p">{</span><span class="nx">$elemMatch</span><span class="o">:</span> 
            <span class="p">{</span><span class="nx">$gt</span><span class="o">:</span> <span class="mf">9</span><span class="p">,</span> <span class="nx">$lt</span><span class="o">:</span> <span class="mf">13</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773d&quot;),
	&quot;nom&quot; : &quot;Paul&quot;,
	&quot;notes&quot; : [
		10,
		12
	],
	&quot;sexe&quot; : &quot;M&quot;
}
{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773c&quot;),
	&quot;nom&quot; : &quot;Jean&quot;,
	&quot;notes&quot; : [
		1,
		5,
		7,
		10,
		12,
		14,
		3
	],
	&quot;ddn&quot; : ISODate(&quot;1995-05-25T00:00:00Z&quot;),
	&quot;sexe&quot; : &quot;M&quot;
}
</pre></div>
</div>
</div>
</div>
<p>Attention : on renvoie bien ici les listes dont <strong>au moins une valeur</strong> vérifie l’ensemble des conditions ! Les notes validant les deux conditions sont 10, 11 et 12. Par exemple, la liste [1,3,8,11,15] sera retournée mais la liste [1,3,8,15] ne le sera pas.</p>
<p>Comment obtenir les étudiants dont <strong>toutes</strong> les notes vérifient les conditions simultanement ? Cela est réalisable grâce à l’opérateur <code class="docutils literal notranslate"><span class="pre">$nor</span></code> vu plus tôt :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="nx">$nor</span><span class="o">:</span> 
        <span class="p">[{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$exists</span><span class="o">:</span> <span class="kc">false</span><span class="p">}},</span>         <span class="cm">/*1ère condition : on retire les documents ne possédant pas de liste &quot;notes&quot;*/</span>
        <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$size</span><span class="o">:</span> <span class="mf">0</span><span class="p">}},</span>                <span class="cm">/*2ème condition : on retire ceux qui n&#39;ont pas de notes*/</span>
        <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$lte</span><span class="o">:</span> <span class="mf">9</span><span class="p">}},</span>                 <span class="cm">/*3ème condition : on retire les étudiants qui ont des notes en dessous de 10*/</span>
        <span class="p">{</span><span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$gte</span><span class="o">:</span> <span class="mf">13</span><span class="p">}}]</span>                <span class="cm">/*4ème condition : on retire ceux qui ont des notes au dessus de 12*/</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
	&quot;_id&quot; : ObjectId(&quot;56011920de43611b917d773d&quot;),
	&quot;nom&quot; : &quot;Paul&quot;,
	&quot;notes&quot; : [
		10,
		12
	],
	&quot;sexe&quot; : &quot;M&quot;
}
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="recapitulatif">
<h2><span class="section-number">2.4. </span>Récapitulatif<a class="headerlink" href="#recapitulatif" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><em>Je souhaite que <strong>toutes les conditions</strong> soient vérifiées <strong>au moins une fois</strong> par les éléments de ma liste, comment faire ?</em></p></li>
</ul>
<blockquote>
<div><p>Code “classique”.</p>
</div></blockquote>
<p>Sans <code class="docutils literal notranslate"><span class="pre">$elemMatch</span></code>, si les conditions sont vérifiées une à une, que ce soit par un élément de la liste ou grâce à plusieurs éléments distincts, alors le document est retourné.</p>
<ul class="simple">
<li><p><em>Je souhaite que <strong>toutes les conditions</strong> soient <strong>simultanement</strong> vérifiées par <strong>au moins un élément</strong> de ma liste, comment faire ?</em></p></li>
</ul>
<blockquote>
<div><p>Utilisation de l’opérateur <code class="docutils literal notranslate"><span class="pre">$elemMtach</span></code>.</p>
</div></blockquote>
<p>Avec <code class="docutils literal notranslate"><span class="pre">$elemMatch</span></code>, on regarde tous les éléments de la liste un par un et on retourne le document si et seulement si au moins un élément est capable de vérifier toutes les conditions à lui tout seul.</p>
<ul class="simple">
<li><p><em>Je souhaite que <strong>toutes les conditions</strong> soient vérifiées par <strong>tous les éléments</strong> de ma liste, comment faire ?</em></p></li>
</ul>
<blockquote>
<div><p>Utilisation de l’opérateur <code class="docutils literal notranslate"><span class="pre">$nor</span></code>.</p>
</div></blockquote>
<p>Avec <code class="docutils literal notranslate"><span class="pre">$nor</span></code>, on liste les conditions que nous ne souhaitons pas retourner. Ainsi, on ne récupère pas les éléments qui valident des conditions. Il faut notamment penser à retirer les éléments vides avec <code class="docutils literal notranslate"><span class="pre">{$size:</span> <span class="pre">0}</span></code> et les éléments inexistants avec <code class="docutils literal notranslate"><span class="pre">{$exists:</span> <span class="pre">false}</span></code>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "imongo"
        },
        kernelOptions: {
            kernelName: "imongo",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'imongo'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="01_find.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">1. </span>Premières requêtes en MongoDB</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03_dates.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3. </span>Attributs de type date</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Ouvrage collectif<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>